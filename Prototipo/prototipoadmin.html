<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prototipo Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    html { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    html, body { scroll-behavior: smooth; }

    @media print {
      body { background: #fff !important; }
      #app, #header, #sidebar { display: none !important; }
      #print-area { display: block !important; }
    }
    #print-area { display: none; }

    .soft-shadow { box-shadow: 0 10px 30px rgba(0,0,0,.08), 0 6px 10px rgba(0,0,0,.06); }
    .modal-overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
    .alert-critical { animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    

    
    .floating-animation {
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-white via-slate-50 to-slate-100 text-slate-900">
  
  <!-- Tela de Login -->
  <div id="loginScreen" class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 flex items-center justify-center p-4">
    <div class="w-full max-w-md">
      <!-- Logo e T√≠tulo -->
      <div class="text-center mb-8">
        <div class="inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-gradient-to-br from-[#E11D48] to-[#BE123C] mb-4 floating-animation soft-shadow">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" class="text-white">
            <path d="M12 2l3 3 4 1-1 4 2 3-2 3 1 4-4 1-3 3-3-3-4-1 1-4-2-3 2-3-1-4 4-1 3-3z" fill="currentColor" opacity=".2"/>
            <path d="M12 6a6 6 0 016 6v6H6v-6a6 6 0 016-6z" stroke="currentColor" stroke-width="1.5" opacity=".8"/>
            <circle cx="12" cy="13" r="2.5" fill="currentColor" opacity=".8"/>
          </svg>
        </div>
        <h1 class="text-3xl font-bold text-slate-900 mb-2">Bombeiro Mirim</h1>
        <p class="text-slate-600">Sistema de Gest√£o v8.1</p>
      </div>

      <!-- Formul√°rio de Login -->
      <div class="bg-white rounded-3xl p-8 soft-shadow border border-slate-200">
        <form id="loginForm" class="space-y-6">
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">Usu√°rio</label>
            <input 
              id="loginUser" 
              type="text" 
              required 
              class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48] focus:border-transparent transition"
              placeholder="Digite seu usu√°rio"
              value="admin"
            />
          </div>
          
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">Senha</label>
            <input 
              id="loginPassword" 
              type="password" 
              required 
              class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48] focus:border-transparent transition"
              placeholder="Digite sua senha"
              value="123456"
            />
          </div>
          
          <div class="flex items-center">
            <input id="rememberMe" type="checkbox" class="w-4 h-4 accent-[#E11D48]" />
            <label for="rememberMe" class="ml-2 text-sm text-slate-600">Lembrar de mim</label>
          </div>
          
          <button 
            type="submit" 
            class="w-full py-3 px-4 rounded-xl bg-[#E11D48] hover:bg-[#BE123C] text-white font-medium transition transform hover:scale-[1.02] active:scale-[0.98]"
          >
            Entrar no Sistema
          </button>
        </form>
        
        <div class="mt-6 pt-6 border-t border-slate-200">
          <div class="text-center text-sm text-slate-500">
            <p>Credenciais de demonstra√ß√£o:</p>
            <p class="font-mono bg-slate-100 px-2 py-1 rounded mt-1">admin / 123456</p>
          </div>
        </div>
      </div>
      
      <!-- Rodap√© -->
      <div class="text-center mt-8 text-slate-500 text-sm">
        <p>¬© 2024 Corpo de Bombeiros - Sistema Interno</p>
      </div>
    </div>
  </div>

  <!-- Sistema Principal -->
  <div id="app" class="min-h-screen hidden">
    <!-- Header -->
    <header id="header" class="sticky top-0 z-30 backdrop-blur bg-white/80 border-b border-slate-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center gap-4">
        <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-[#E11D48]/10 text-[#E11D48] soft-shadow">
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none" class="drop-shadow">
            <path d="M12 2l3 3 4 1-1 4 2 3-2 3 1 4-4 1-3 3-3-3-4-1 1-4-2-3 2-3-1-4 4-1 3-3z" fill="currentColor" opacity=".15"/>
            <path d="M12 6a6 6 0 016 6v6H6v-6a6 6 0 016-6z" stroke="currentColor" stroke-width="1.5" opacity=".6"/>
            <circle cx="12" cy="13" r="2.2" fill="currentColor" opacity=".6"/>
          </svg>
        </div>
        <div class="flex-1">
          <h1 class="text-xl sm:text-2xl font-bold tracking-tight text-slate-900">Programa Bombeiro Mirim</h1>
          <p class="text-slate-500 text-sm">Sistema de gest√£o - Vers√£o 8.1</p>
        </div>
        <div class="flex items-center gap-3">
          <div class="hidden md:flex items-center gap-2">
            <span class="px-3 py-1 rounded-full bg-green-100 text-green-700 text-xs border border-green-200">Sistema Ativo</span>
            <span class="px-3 py-1 rounded-full bg-[#E11D48]/10 text-[#BE123C] text-xs border border-[#E11D48]/20">Usu√°rio: Admin</span>
          </div>
          <button id="btnLogout" class="px-3 py-2 rounded-lg bg-slate-900 hover:bg-slate-800 text-white text-sm transition">
            Sair
          </button>
        </div>
      </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 grid grid-cols-1 lg:grid-cols-[280px,1fr] gap-6">
      <!-- Sidebar -->
      <aside id="sidebar" class="lg:sticky lg:top-20 self-start">
        <nav class="bg-white rounded-2xl p-3 soft-shadow border border-slate-200">
          <ul class="space-y-2">
            <li><button data-section="presencas" class="nav-btn w-full text-left px-4 py-3 rounded-xl text-slate-700 hover:bg-slate-50 hover:text-slate-900 transition flex items-center gap-2">
              <span class="text-lg">üóìÔ∏è</span><span>Presen√ßas</span>
            </button></li>
            <li><button data-section="cadastro" class="nav-btn w-full text-left px-4 py-3 rounded-xl text-slate-700 hover:bg-slate-50 hover:text-slate-900 transition flex items-center gap-2">
              <span class="text-lg">üë∂</span><span>Cadastro</span>
            </button></li>
            <li><button data-section="gerenciar" class="nav-btn w-full text-left px-4 py-3 rounded-xl text-slate-700 hover:bg-slate-50 hover:text-slate-900 transition flex items-center gap-2">
              <span class="text-lg">üë•</span><span>Gerenciar Alunos</span>
            </button></li>
            <li><button data-section="comunicacao" class="nav-btn w-full text-left px-4 py-3 rounded-xl text-slate-700 hover:bg-slate-50 hover:text-slate-900 transition flex items-center gap-2">
              <span class="text-lg">üí¨</span><span>Comunica√ß√£o</span>
            </button></li>
            <li><button data-section="relatorios" class="nav-btn w-full text-left px-4 py-3 rounded-xl text-slate-700 hover:bg-slate-50 hover:text-slate-900 transition flex items-center gap-2">
              <span class="text-lg">üìä</span><span>Relat√≥rios</span>
            </button></li>
            <li><button data-section="dashboard" class="nav-btn w-full text-left px-4 py-3 rounded-xl text-slate-700 hover:bg-slate-50 hover:text-slate-900 transition flex items-center gap-2">
              <span class="text-lg">üìà</span><span>Dashboard</span>
            </button></li>
          </ul>
        </nav>
      </aside>

      <!-- Main Sections -->
      <main class="space-y-6">
        <!-- Presen√ßas (Tela Inicial) -->
        <section id="presencas" class="bg-white rounded-3xl p-6 soft-shadow border border-slate-200">
          <div class="flex flex-col md:flex-row md:items-end gap-3 mb-6">
            <div class="flex-1">
              <h2 class="text-2xl font-bold text-slate-900 mb-1">Controle de Presen√ßas</h2>
              <p class="text-slate-500">Registre presen√ßa, falta ou atraso por turma</p>
            </div>
            <div class="flex flex-col sm:flex-row gap-3">
              <div>
                <label class="block text-sm font-medium mb-1">Turma</label>
                <select id="turmaPresenca" class="px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                  <option value="">Selecione uma turma</option>
                  <option value="turma-a">Turma A - Manh√£</option>
                  <option value="turma-b">Turma B - Tarde</option>
                  <option value="turma-c">Turma C - Integral</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Data</label>
                <input id="dataPresenca" type="date" class="px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" />
              </div>
              <div class="flex items-end">
                <button id="btnSalvarPresencas" class="px-6 py-2 rounded-lg bg-[#E11D48] hover:bg-[#BE123C] text-white transition">
                  Salvar Presen√ßas
                </button>
              </div>
            </div>
          </div>

          <!-- Resumo R√°pido -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-4 text-white text-center">
              <div class="text-2xl font-bold" id="totalHoje">0</div>
              <div class="text-sm opacity-90">Total Hoje</div>
            </div>
            <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-4 text-white text-center">
              <div class="text-2xl font-bold" id="presentesHoje">0</div>
              <div class="text-sm opacity-90">Presentes</div>
            </div>
            <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl p-4 text-white text-center">
              <div class="text-2xl font-bold" id="atrasosHoje">0</div>
              <div class="text-sm opacity-90">Atrasos</div>
            </div>
            <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-xl p-4 text-white text-center">
              <div class="text-2xl font-bold" id="faltasHoje">0</div>
              <div class="text-sm opacity-90">Faltas</div>
            </div>
          </div>

          <div class="overflow-x-auto">
            <table class="w-full border border-slate-200 rounded-xl overflow-hidden">
              <thead class="bg-slate-50">
                <tr class="text-left text-sm">
                  <th class="p-4">Crian√ßa</th>
                  <th class="p-4">Status</th>
                  <th class="p-4">Observa√ß√µes</th>
                </tr>
              </thead>
              <tbody id="tabelaPresencas" class="text-sm"></tbody>
            </table>
          </div>
        </section>

        <!-- Cadastro -->
        <section id="cadastro" class="bg-white rounded-3xl p-6 soft-shadow border border-slate-200 hidden">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h2 class="text-2xl font-bold text-slate-900 mb-1">Cadastro de Crian√ßas</h2>
              <p class="text-slate-500">Gerencie os dados das crian√ßas do programa</p>
            </div>
            <div class="flex gap-2">
              <button id="btnNovo" class="px-4 py-2 rounded-lg bg-slate-900 hover:bg-slate-800 text-white transition">Novo</button>
              <button id="btnSalvar" class="px-4 py-2 rounded-lg bg-[#E11D48] hover:bg-[#BE123C] text-white transition">Salvar</button>
            </div>
          </div>

          <form id="formCadastro" class="grid md:grid-cols-2 gap-4 mb-8" autocomplete="off">
            <input type="hidden" id="childId" />
            
            <!-- Dados B√°sicos -->
            <div class="md:col-span-2 border-b pb-4 mb-4">
              <h3 class="font-semibold mb-3 text-[#E11D48]">Dados B√°sicos</h3>
              <div class="grid md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-1">Nome completo *</label>
                  <input id="nome" required class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="Ex.: Ana Pereira" />
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">CPF da crian√ßa *</label>
                  <input id="cpf" required class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="000.000.000-00" maxlength="14" />
                  <div id="cpfError" class="text-red-500 text-xs mt-1 hidden">CPF inv√°lido</div>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Data de nascimento *</label>
                  <input id="nascimento" type="date" required class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" />
                  <div id="idadeError" class="text-red-500 text-xs mt-1 hidden">Crian√ßa deve ter entre 7 e 14 anos</div>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Escola</label>
                  <input id="escola" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="Nome da escola" />
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Turma *</label>
                  <select id="turmaSelect" required class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                    <option value="">Selecione uma turma</option>
                    <option value="turma-a">Turma A - Manh√£</option>
                    <option value="turma-b">Turma B - Tarde</option>
                    <option value="turma-c">Turma C - Integral</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">ID interno</label>
                  <input id="idInterno" disabled class="w-full px-4 py-2 rounded-lg border border-slate-200 bg-slate-50" placeholder="Gerado automaticamente" />
                </div>
              </div>
            </div>

            <!-- Respons√°vel Principal -->
            <div class="md:col-span-2 border-b pb-4 mb-4">
              <h3 class="font-semibold mb-3 text-[#E11D48]">Respons√°vel Principal</h3>
              <div class="grid md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-1">Nome completo *</label>
                  <input id="nomeResp" required class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="Nome do respons√°vel" />
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Contato *</label>
                  <input id="contatoResp" required class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="(xx) xxxxx-xxxx" />
                  <div id="contatoError" class="text-red-500 text-xs mt-1 hidden">Formato inv√°lido</div>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Parentesco *</label>
                  <select id="parentesco" required class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                    <option value="">Selecione</option>
                    <option value="Pai">Pai</option>
                    <option value="M√£e">M√£e</option>
                    <option value="Av√¥">Av√¥</option>
                    <option value="Av√≥">Av√≥</option>
                    <option value="Tio">Tio</option>
                    <option value="Tia">Tia</option>
                    <option value="Respons√°vel Legal">Respons√°vel Legal</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Informa√ß√µes M√©dicas -->
            <div class="md:col-span-2 border-b pb-4 mb-4">
              <h3 class="font-semibold mb-3 text-[#E11D48]">Informa√ß√µes M√©dicas</h3>
              <div class="grid md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-1">Condi√ß√£o m√©dica</label>
                  <select id="condicaoMedica" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                    <option value="normal">Normal</option>
                    <option value="asma">Asma</option>
                    <option value="diabetes">Diabetes</option>
                    <option value="epilepsia">Epilepsia</option>
                    <option value="cardiopatia">Cardiopatia</option>
                    <option value="outras">Outras</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Alergias</label>
                  <input id="alergias" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="Ex.: poeira, lactose..." />
                </div>
              </div>
              <div class="mt-3">
                <label class="block text-sm font-medium mb-1">Observa√ß√µes m√©dicas importantes</label>
                <textarea id="obsMedicas" rows="2" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="Informa√ß√µes importantes para emerg√™ncias"></textarea>
              </div>
              <div id="alertaMedico" class="mt-3 p-3 rounded-lg bg-red-50 border border-red-200 text-red-700 hidden alert-critical">
                ‚ö†Ô∏è <strong>ATEN√á√ÉO:</strong> Esta crian√ßa possui condi√ß√£o m√©dica que requer cuidados especiais!
              </div>
            </div>

            <!-- Acompanhamento Especial -->
            <div class="md:col-span-2">
              <div class="flex items-center gap-3 mb-3">
                <input id="acompanhamento" type="checkbox" class="w-5 h-5 accent-[#E11D48]" />
                <label for="acompanhamento" class="font-semibold text-[#E11D48]">Necessita acompanhamento pedag√≥gico especial</label>
              </div>
              <div id="acompanhamentoExtra" class="grid md:grid-cols-2 gap-4 hidden">
                <div>
                  <label class="block text-sm font-medium mb-1">Tipo de necessidade</label>
                  <select id="tipoAcompanhamento" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                    <option value="">Selecione</option>
                    <option value="autismo">Transtorno do Espectro Autista</option>
                    <option value="tdah">TDAH</option>
                    <option value="dislexia">Dislexia</option>
                    <option value="deficiencia_intelectual">Defici√™ncia Intelectual</option>
                    <option value="outros">Outros</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Observa√ß√µes</label>
                  <textarea id="obsAcompanhamento" rows="2" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="Estrat√©gias e cuidados especiais"></textarea>
                </div>
              </div>
            </div>
          </form>


        </section>

        <!-- Gerenciar Alunos -->
        <section id="gerenciar" class="bg-white rounded-3xl p-6 soft-shadow border border-slate-200 hidden">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h2 class="text-2xl font-bold text-slate-900 mb-1">Gerenciar Alunos</h2>
              <p class="text-slate-500">Busque, edite e remova alunos do sistema</p>
            </div>
            <button id="btnExportarGerenciar" class="px-4 py-2 rounded-lg bg-slate-900 hover:bg-slate-800 text-white transition">Exportar Lista</button>
          </div>

          <!-- Filtros de Busca -->
          <div class="grid md:grid-cols-4 gap-4 mb-6">
            <div class="md:col-span-2">
              <label class="block text-sm font-medium mb-1">Buscar aluno</label>
              <input id="buscaGerenciar" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="Nome, CPF ou respons√°vel..." />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Filtrar por turma</label>
              <select id="filtroTurmaGerenciar" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                <option value="">Todas as turmas</option>
                <option value="turma-a">Turma A - Manh√£</option>
                <option value="turma-b">Turma B - Tarde</option>
                <option value="turma-c">Turma C - Integral</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Status especial</label>
              <select id="filtroStatus" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                <option value="">Todos</option>
                <option value="medico">Com alerta m√©dico</option>
                <option value="pedagogico">Acompanhamento pedag√≥gico</option>
                <option value="normal">Sem alertas</option>
              </select>
            </div>
          </div>

          <!-- Lista de Alunos -->
          <div class="overflow-x-auto">
            <table class="w-full border border-slate-200 rounded-xl overflow-hidden">
              <thead class="bg-slate-50">
                <tr class="text-left text-sm">
                  <th class="p-3">Aluno</th>
                  <th class="p-3">CPF</th>
                  <th class="p-3">Turma</th>
                  <th class="p-3">Respons√°vel</th>
                  <th class="p-3">Contato</th>
                  <th class="p-3">Status</th>
                  <th class="p-3">A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="listaAlunosGerenciar" class="text-sm"></tbody>
            </table>
          </div>
        </section>

        <!-- Comunica√ß√£o -->
        <section id="comunicacao" class="bg-white rounded-3xl p-6 soft-shadow border border-slate-200 hidden">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h2 class="text-2xl font-bold text-slate-900 mb-1">Central de Comunica√ß√£o</h2>
              <p class="text-slate-500">Comunique-se com a equipe e respons√°veis</p>
            </div>
            <div class="flex gap-2">
              <button id="btnNovaMsg" class="px-4 py-2 rounded-lg bg-[#E11D48] hover:bg-[#BE123C] text-white transition">Nova Mensagem</button>
              <button id="btnMarcarLidas" class="px-4 py-2 rounded-lg bg-slate-900 hover:bg-slate-800 text-white transition">Marcar como Lidas</button>
            </div>
          </div>

          <!-- Abas de Comunica√ß√£o -->
          <div class="flex border-b border-slate-200 mb-6">
            <button id="tabEquipe" class="tab-btn px-4 py-2 border-b-2 border-[#E11D48] text-[#E11D48] font-medium">Equipe Interna</button>
            <button id="tabResponsaveis" class="tab-btn px-4 py-2 border-b-2 border-transparent text-slate-500 hover:text-slate-700">Respons√°veis</button>
            <button id="tabAvisos" class="tab-btn px-4 py-2 border-b-2 border-transparent text-slate-500 hover:text-slate-700">Avisos Gerais</button>
          </div>

          <!-- Conte√∫do das Abas -->
          <div id="comunicacaoEquipe" class="tab-content">
            <div class="grid lg:grid-cols-3 gap-6">
              <!-- Lista de Conversas -->
              <div class="lg:col-span-1">
                <h3 class="font-semibold mb-3">Conversas da Equipe</h3>
                <div id="listaConversasEquipe" class="space-y-2 max-h-96 overflow-y-auto">
                  <!-- Conversas ser√£o inseridas aqui -->
                </div>
              </div>
              
              <!-- Chat -->
              <div class="lg:col-span-2">
                <div class="border border-slate-200 rounded-xl h-96 flex flex-col">
                  <div class="p-4 border-b border-slate-200 bg-slate-50 rounded-t-xl">
                    <h4 class="font-medium" id="chatTitulo">Selecione uma conversa</h4>
                  </div>
                  <div id="chatMensagens" class="flex-1 p-4 overflow-y-auto space-y-3">
                    <div class="text-center text-slate-500 py-8">Selecione uma conversa para come√ßar</div>
                  </div>
                  <div class="p-4 border-t border-slate-200">
                    <div class="flex gap-2">
                      <input id="inputMensagem" class="flex-1 px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="Digite sua mensagem..." disabled />
                      <button id="btnEnviar" class="px-4 py-2 rounded-lg bg-[#E11D48] hover:bg-[#BE123C] text-white transition" disabled>Enviar</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div id="comunicacaoResponsaveis" class="tab-content hidden">
            <div class="grid lg:grid-cols-2 gap-6">
              <!-- Enviar Mensagem -->
              <div>
                <h3 class="font-semibold mb-3">Enviar Mensagem para Respons√°veis</h3>
                <form id="formMensagemResp" class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium mb-1">Destinat√°rios</label>
                    <select id="destinatarios" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                      <option value="todos">Todos os respons√°veis</option>
                      <option value="turma-a">Respons√°veis - Turma A</option>
                      <option value="turma-b">Respons√°veis - Turma B</option>
                      <option value="turma-c">Respons√°veis - Turma C</option>
                      <option value="individual">Respons√°vel espec√≠fico</option>
                    </select>
                  </div>
                  
                  <div id="seletorIndividual" class="hidden">
                    <label class="block text-sm font-medium mb-1">Selecionar respons√°vel</label>
                    <select id="responsavelIndividual" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                      <option value="">Escolha um respons√°vel</option>
                    </select>
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Assunto</label>
                    <input id="assuntoMsg" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="Ex: Reuni√£o de pais, Atividade especial..." />
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Mensagem</label>
                    <textarea id="conteudoMsg" rows="6" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="Digite sua mensagem aqui..."></textarea>
                  </div>
                  
                  <div class="flex items-center gap-2">
                    <input id="urgente" type="checkbox" class="w-4 h-4 accent-[#E11D48]" />
                    <label for="urgente" class="text-sm">Marcar como urgente</label>
                  </div>
                  
                  <button type="submit" class="w-full py-3 px-4 rounded-lg bg-[#E11D48] hover:bg-[#BE123C] text-white transition">Enviar Mensagem</button>
                </form>
              </div>
              
              <!-- Hist√≥rico de Mensagens -->
              <div>
                <h3 class="font-semibold mb-3">Mensagens Enviadas</h3>
                <div id="historicoMensagens" class="space-y-3 max-h-96 overflow-y-auto">
                  <!-- Mensagens ser√£o inseridas aqui -->
                </div>
              </div>
            </div>
          </div>

          <div id="comunicacaoAvisos" class="tab-content hidden">
            <div class="grid lg:grid-cols-2 gap-6">
              <!-- Criar Aviso -->
              <div>
                <h3 class="font-semibold mb-3">Criar Aviso Geral</h3>
                <form id="formAviso" class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium mb-1">Tipo de aviso</label>
                    <select id="tipoAviso" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                      <option value="informativo">Informativo</option>
                      <option value="importante">Importante</option>
                      <option value="urgente">Urgente</option>
                      <option value="evento">Evento</option>
                    </select>
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">T√≠tulo do aviso</label>
                    <input id="tituloAviso" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="Ex: Reuni√£o de pais, Feriado..." />
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Conte√∫do</label>
                    <textarea id="conteudoAviso" rows="6" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="Descreva o aviso..."></textarea>
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium mb-1">Data de validade (opcional)</label>
                    <input id="validadeAviso" type="date" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" />
                  </div>
                  
                  <button type="submit" class="w-full py-3 px-4 rounded-lg bg-[#E11D48] hover:bg-[#BE123C] text-white transition">Publicar Aviso</button>
                </form>
              </div>
              
              <!-- Lista de Avisos -->
              <div>
                <h3 class="font-semibold mb-3">Avisos Ativos</h3>
                <div id="listaAvisos" class="space-y-3 max-h-96 overflow-y-auto">
                  <!-- Avisos ser√£o inseridos aqui -->
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Relat√≥rios -->
        <section id="relatorios" class="bg-white rounded-3xl p-6 soft-shadow border border-slate-200 hidden">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold">Relat√≥rios</h2>
            <div class="flex gap-2">
              <button id="btnGerarRelatorio" class="px-4 py-2 rounded-lg bg-slate-900 hover:bg-slate-800 text-white transition">Gerar</button>
              <button id="btnExportRelatorio" class="px-4 py-2 rounded-lg bg-[#E11D48] hover:bg-[#BE123C] text-white transition">Exportar</button>
            </div>
          </div>

          <div class="grid md:grid-cols-4 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium mb-1">Tipo de relat√≥rio</label>
              <select id="tipoRelatorio" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                <option value="presencas">Presen√ßas por per√≠odo</option>
                <option value="individual">Relat√≥rio individual</option>
                <option value="turma">Resumo por turma</option>
                <option value="medico">Condi√ß√µes m√©dicas</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Data inicial</label>
              <input id="dataInicio" type="date" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Data final</label>
              <input id="dataFim" type="date" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Turma</label>
              <select id="relTurma" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                <option value="">Todas</option>
                <option value="turma-a">Turma A - Manh√£</option>
                <option value="turma-b">Turma B - Tarde</option>
                <option value="turma-c">Turma C - Integral</option>
              </select>
            </div>
          </div>

          <div id="relatorioConteudo" class="overflow-x-auto">
            <div class="text-center py-8 text-slate-500">
              Selecione os filtros e clique em "Gerar" para visualizar o relat√≥rio
            </div>
          </div>
        </section>

        <!-- Dashboard -->
        <section id="dashboard" class="bg-white rounded-3xl p-6 soft-shadow border border-slate-200 hidden">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold">Dashboard</h2>
            <button id="btnAtualizarDash" class="px-4 py-2 rounded-lg bg-slate-900 hover:bg-slate-800 text-white transition">Atualizar</button>
          </div>

          <!-- KPIs -->
          <div class="grid md:grid-cols-4 gap-4 mb-6">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-4 text-white">
              <div class="text-2xl font-bold" id="totalAlunos">0</div>
              <div class="text-sm opacity-90">Total de Alunos</div>
            </div>
            <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-4 text-white">
              <div class="text-2xl font-bold" id="presencaMedia">0%</div>
              <div class="text-sm opacity-90">Taxa de Presen√ßa</div>
            </div>
            <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl p-4 text-white">
              <div class="text-2xl font-bold" id="alertasMedicos">0</div>
              <div class="text-sm opacity-90">Alertas M√©dicos</div>
            </div>
            <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-4 text-white">
              <div class="text-2xl font-bold" id="acompanhamentoEspecial">0</div>
              <div class="text-sm opacity-90">Acompanhamento Especial</div>
            </div>
          </div>

          <!-- Resumo por Turma -->
          <div class="grid lg:grid-cols-2 gap-6">
            <div class="border rounded-2xl p-4 border-slate-200">
              <h3 class="font-semibold mb-3">Resumo por Turma</h3>
              <div id="resumoTurmas" class="space-y-3"></div>
            </div>
            <div class="border rounded-2xl p-4 border-slate-200">
              <h3 class="font-semibold mb-3">√öltimas Atividades</h3>
              <div id="ultimasAtividades" class="space-y-3"></div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- Modal de Confirma√ß√£o -->
  <div id="modalConfirmacao" class="fixed inset-0 z-50 hidden modal-overlay">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-2xl p-6 w-full max-w-md soft-shadow">
        <h3 class="text-lg font-semibold mb-4" id="tituloModal">Confirmar a√ß√£o</h3>
        <p class="text-slate-600 mb-6" id="mensagemModal">Tem certeza que deseja realizar esta a√ß√£o?</p>
        <div class="flex justify-end gap-2">
          <button id="btnCancelar" class="px-4 py-2 rounded-lg bg-slate-300 hover:bg-slate-400 text-slate-700 transition">Cancelar</button>
          <button id="btnConfirmar" class="px-4 py-2 rounded-lg bg-[#E11D48] hover:bg-[#BE123C] text-white transition">Confirmar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- √Årea para impress√£o -->
  <div id="print-area" class="p-6">
    <h2 class="text-2xl font-bold mb-4">Relat√≥rio ‚Äî Programa Bombeiro Mirim</h2>
    <div id="print-content"></div>
  </div>

  <script>
    // Utilidades
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => document.querySelectorAll(sel);

    // Estado da aplica√ß√£o
    const state = {
      criancas: [],
      presencas: [],
      currentAction: null,
      isLoggedIn: false
    };

    function uid() {
      return 'BM' + Math.random().toString(36).slice(2, 9).toUpperCase();
    }

    // LOGIN
    function setupLogin() {
      $('#loginForm').addEventListener('submit', (e) => {
        e.preventDefault();
        
        const user = $('#loginUser').value.trim();
        const password = $('#loginPassword').value.trim();
        
        // Valida√ß√£o simples (demo)
        if (user === 'admin' && password === '123456') {
          state.isLoggedIn = true;
          $('#loginScreen').classList.add('hidden');
          $('#app').classList.remove('hidden');
          
          // Inicializar sistema
          initSystem();
        } else {
          alert('Usu√°rio ou senha incorretos!\n\nUse: admin / 123456');
        }
      });
      
      $('#btnLogout').addEventListener('click', () => {
        mostrarModal('Confirmar logout', 'Deseja realmente sair do sistema?', () => {
          state.isLoggedIn = false;
          $('#app').classList.add('hidden');
          $('#loginScreen').classList.remove('hidden');
          
          // Limpar campos de login
          $('#loginUser').value = 'admin';
          $('#loginPassword').value = '123456';
        });
      });
    }

    // Valida√ß√£o de CPF
    function validarCPF(cpf) {
      cpf = cpf.replace(/[^\d]/g, '');
      if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
      
      let soma = 0;
      for (let i = 0; i < 9; i++) soma += parseInt(cpf[i]) * (10 - i);
      let resto = (soma * 10) % 11;
      if (resto === 10 || resto === 11) resto = 0;
      if (resto !== parseInt(cpf[9])) return false;
      
      soma = 0;
      for (let i = 0; i < 10; i++) soma += parseInt(cpf[i]) * (11 - i);
      resto = (soma * 10) % 11;
      if (resto === 10 || resto === 11) resto = 0;
      return resto === parseInt(cpf[10]);
    }

    // Formata√ß√£o de CPF
    function formatarCPF(cpf) {
      cpf = cpf.replace(/[^\d]/g, '');
      return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
    }

    // Valida√ß√£o de idade (7 a 14 anos)
    function validarIdade(dataNascimento) {
      const hoje = new Date();
      const nascimento = new Date(dataNascimento);
      const idade = hoje.getFullYear() - nascimento.getFullYear();
      const mesAtual = hoje.getMonth();
      const mesNascimento = nascimento.getMonth();
      
      let idadeReal = idade;
      if (mesAtual < mesNascimento || (mesAtual === mesNascimento && hoje.getDate() < nascimento.getDate())) {
        idadeReal--;
      }
      
      return idadeReal >= 7 && idadeReal <= 14;
    }

    // Valida√ß√£o de contato
    function validarContato(contato) {
      const regex = /^\(\d{2}\)\s\d{4,5}-\d{4}$/;
      return regex.test(contato);
    }

    // Armazenamento local
    function salvarLS() {
      localStorage.setItem('bm_criancas_v8_1', JSON.stringify(state.criancas));
      localStorage.setItem('bm_presencas_v8_1', JSON.stringify(state.presencas));
    }

    function carregarLS() {
      try {
        state.criancas = JSON.parse(localStorage.getItem('bm_criancas_v8_1') || '[]');
        state.presencas = JSON.parse(localStorage.getItem('bm_presencas_v8_1') || '[]');
      } catch(e) {
        state.criancas = [];
        state.presencas = [];
      }
      
      // Dados de exemplo se vazio
      if (state.criancas.length === 0) {
        state.criancas = [
          {
            id: uid(),
            nome: 'Ana Pereira Silva',
            cpf: '12345678901',
            nascimento: '2013-05-12',
            escola: 'EMEF Vila Rosa',
            turma: 'turma-a',
            nomeResp: 'Marcos Pereira',
            contatoResp: '(11) 99999-1111',
            parentesco: 'Pai',
            condicaoMedica: 'asma',
            alergias: 'poeira, √°caros',
            obsMedicas: 'Evitar atividades f√≠sicas intensas',
            acompanhamento: false,
            tipoAcompanhamento: '',
            obsAcompanhamento: ''
          },
          {
            id: uid(),
            nome: 'Bruno Santos Costa',
            cpf: '98765432100',
            nascimento: '2012-11-02',
            escola: 'EMEF Centro',
            turma: 'turma-b',
            nomeResp: 'Paula Santos',
            contatoResp: '(11) 97777-3333',
            parentesco: 'M√£e',
            condicaoMedica: 'normal',
            alergias: '',
            obsMedicas: '',
            acompanhamento: true,
            tipoAcompanhamento: 'autismo',
            obsAcompanhamento: 'Necessita rotina estruturada e pausas regulares'
          },
          {
            id: uid(),
            nome: 'Carla Oliveira Lima',
            cpf: '11122233344',
            nascimento: '2014-03-15',
            escola: 'EMEF Jardim',
            turma: 'turma-a',
            nomeResp: 'Roberto Lima',
            contatoResp: '(11) 98888-4444',
            parentesco: 'Pai',
            condicaoMedica: 'normal',
            alergias: '',
            obsMedicas: '',
            acompanhamento: false,
            tipoAcompanhamento: '',
            obsAcompanhamento: ''
          }
        ];
        
        // Presen√ßas de exemplo
        const hoje = new Date();
        const ontem = new Date(hoje);
        ontem.setDate(ontem.getDate() - 1);
        
        state.presencas = [
          {
            id: uid(),
            childId: state.criancas[0].id,
            data: hoje.toISOString().slice(0, 10),
            status: 'presente',
            observacoes: ''
          },
          {
            id: uid(),
            childId: state.criancas[1].id,
            data: hoje.toISOString().slice(0, 10),
            status: 'atraso',
            observacoes: 'Chegou 15 minutos atrasado'
          },
          {
            id: uid(),
            childId: state.criancas[2].id,
            data: hoje.toISOString().slice(0, 10),
            status: 'presente',
            observacoes: ''
          }
        ];
        
        salvarLS();
      }
    }

    // Navega√ß√£o
    function setupNav() {
      const sections = ['presencas', 'cadastro', 'gerenciar', 'comunicacao', 'relatorios', 'dashboard'];
      
      function show(id) {
        sections.forEach(s => {
          const el = document.getElementById(s);
          if (el) el.classList.toggle('hidden', s !== id);
        });
        
        $$('.nav-btn').forEach(b => b.classList.remove('bg-[#E11D48]', 'text-white'));
        const active = [...$$('.nav-btn')].find(b => b.dataset.section === id);
        if (active) active.classList.add('bg-[#E11D48]', 'text-white');
        
        // A√ß√µes ao entrar na se√ß√£o
        switch(id) {
          case 'presencas':
            $('#dataPresenca').value = new Date().toISOString().slice(0, 10);
            renderPresencasTable();
            atualizarResumoPresencas();
            break;
          case 'cadastro':
            limparCadastro();
            break;
          case 'gerenciar':
            renderListaGerenciar();
            break;
          case 'comunicacao':
            setupComunicacaoTabs();
            renderComunicacao();
            break;
          case 'dashboard':
            atualizarDashboard();
            break;
        }
      }
      
      $$('.nav-btn').forEach(btn => btn.addEventListener('click', () => show(btn.dataset.section)));
      show('presencas'); // Presen√ßas como tela inicial
    }

    // PRESEN√áAS
    function setupPresencas() {
      $('#turmaPresenca').addEventListener('change', () => {
        renderPresencasTable();
        atualizarResumoPresencas();
      });
      $('#dataPresenca').addEventListener('change', () => {
        renderPresencasTable();
        atualizarResumoPresencas();
      });
      
      $('#btnSalvarPresencas').addEventListener('click', (e) => {
        e.preventDefault();
        salvarPresencas();
      });
    }

    function renderPresencasTable() {
      const tbody = $('#tabelaPresencas');
      const turma = $('#turmaPresenca').value;
      const data = $('#dataPresenca').value || new Date().toISOString().slice(0, 10);
      
      $('#dataPresenca').value = data;
      tbody.innerHTML = '';
      
      if (!turma) {
        tbody.innerHTML = '<tr><td colspan="3" class="p-4 text-center text-slate-500">Selecione uma turma para visualizar as crian√ßas</td></tr>';
        return;
      }
      
      const criancas = state.criancas
        .filter(c => c.turma === turma)
        .sort((a, b) => a.nome.localeCompare(b.nome));
      
      if (criancas.length === 0) {
        tbody.innerHTML = '<tr><td colspan="3" class="p-4 text-center text-slate-500">Nenhuma crian√ßa cadastrada nesta turma</td></tr>';
        return;
      }
      
      for (const c of criancas) {
        const registro = state.presencas.find(p => p.childId === c.id && p.data === data) || {
          status: 'presente',
          observacoes: ''
        };
        
        const tr = document.createElement('tr');
        tr.className = 'border-t align-top hover:bg-slate-50';
        tr.innerHTML = `
          <td class="p-4">
            <div class="font-medium text-slate-900">${c.nome}</div>
            <div class="text-sm text-slate-500">ID: ${c.id}</div>
            ${c.condicaoMedica !== 'normal' ? 
              '<div class="text-xs text-red-600 mt-1">‚ö†Ô∏è Condi√ß√£o m√©dica especial</div>' : ''
            }
            ${c.acompanhamento ? 
              '<div class="text-xs text-purple-600 mt-1">üìö Acompanhamento pedag√≥gico</div>' : ''
            }
          </td>
          <td class="p-4">
            <select data-id="${c.id}" class="sel-presenca w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
              <option value="presente" ${registro.status === 'presente' ? 'selected' : ''}>‚úÖ Presente</option>
              <option value="falta" ${registro.status === 'falta' ? 'selected' : ''}>‚ùå Falta</option>
              <option value="atraso" ${registro.status === 'atraso' ? 'selected' : ''}>‚è∞ Atraso</option>
            </select>
          </td>
          <td class="p-4">
            <textarea data-id="${c.id}" class="inp-obs w-full px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48] text-sm" 
                      rows="2" placeholder="Observa√ß√µes sobre a presen√ßa...">${registro.observacoes || ''}</textarea>
          </td>
        `;
        tbody.appendChild(tr);
      }
    }

    function atualizarResumoPresencas() {
      const data = $('#dataPresenca').value || new Date().toISOString().slice(0, 10);
      const turma = $('#turmaPresenca').value;
      
      let presencasHoje = state.presencas.filter(p => p.data === data);
      
      if (turma) {
        const criancasDaTurma = state.criancas.filter(c => c.turma === turma).map(c => c.id);
        presencasHoje = presencasHoje.filter(p => criancasDaTurma.includes(p.childId));
      }
      
      const total = presencasHoje.length;
      const presentes = presencasHoje.filter(p => p.status === 'presente').length;
      const atrasos = presencasHoje.filter(p => p.status === 'atraso').length;
      const faltas = presencasHoje.filter(p => p.status === 'falta').length;
      
      $('#totalHoje').textContent = total;
      $('#presentesHoje').textContent = presentes;
      $('#atrasosHoje').textContent = atrasos;
      $('#faltasHoje').textContent = faltas;
    }

    function salvarPresencas() {
      const turma = $('#turmaPresenca').value;
      const data = $('#dataPresenca').value;
      
      if (!turma || !data) {
        alert('Selecione uma turma e data');
        return;
      }
      
      const sels = $$('.sel-presenca');
      const obss = $$('.inp-obs');
      
      const mapObs = {};
      obss.forEach(o => mapObs[o.dataset.id] = o.value.trim());
      
      sels.forEach(sel => {
        const childId = sel.dataset.id;
        const status = sel.value;
        const observacoes = mapObs[childId] || '';
        
        let reg = state.presencas.find(p => p.childId === childId && p.data === data);
        
        if (!reg) {
          reg = {
            id: uid(),
            childId,
            data,
            status,
            observacoes
          };
          state.presencas.push(reg);
        } else {
          reg.status = status;
          reg.observacoes = observacoes;
        }
      });
      
      salvarLS();
      atualizarResumoPresencas();
      alert('Presen√ßas salvas com sucesso!');
    }

    // CADASTRO (mesmo c√≥digo da vers√£o anterior)
    function setupCadastro() {
      // Formata√ß√£o autom√°tica do CPF
      $('#cpf').addEventListener('input', (e) => {
        let value = e.target.value.replace(/[^\d]/g, '');
        if (value.length <= 11) {
          e.target.value = formatarCPF(value);
        }
      });

      // Formata√ß√£o do contato
      $('#contatoResp').addEventListener('input', (e) => {
        let value = e.target.value.replace(/[^\d]/g, '');
        if (value.length <= 11) {
          value = value.replace(/(\d{2})(\d{4,5})(\d{4})/, '($1) $2-$3');
          e.target.value = value;
        }
      });

      // Valida√ß√µes em tempo real
      $('#cpf').addEventListener('blur', (e) => {
        const cpf = e.target.value.replace(/[^\d]/g, '');
        const errorDiv = $('#cpfError');
        if (cpf && !validarCPF(cpf)) {
          errorDiv.classList.remove('hidden');
          e.target.classList.add('border-red-500');
        } else {
          errorDiv.classList.add('hidden');
          e.target.classList.remove('border-red-500');
        }
      });

      $('#nascimento').addEventListener('blur', (e) => {
        const data = e.target.value;
        const errorDiv = $('#idadeError');
        if (data && !validarIdade(data)) {
          errorDiv.classList.remove('hidden');
          e.target.classList.add('border-red-500');
        } else {
          errorDiv.classList.add('hidden');
          e.target.classList.remove('border-red-500');
        }
      });

      $('#contatoResp').addEventListener('blur', (e) => {
        const contato = e.target.value;
        const errorDiv = $('#contatoError');
        if (contato && !validarContato(contato)) {
          errorDiv.classList.remove('hidden');
          e.target.classList.add('border-red-500');
        } else {
          errorDiv.classList.add('hidden');
          e.target.classList.remove('border-red-500');
        }
      });

      // Condi√ß√£o m√©dica
      $('#condicaoMedica').addEventListener('change', (e) => {
        const alerta = $('#alertaMedico');
        const condicoesCriticas = ['asma', 'diabetes', 'epilepsia', 'cardiopatia'];
        alerta.classList.toggle('hidden', !condicoesCriticas.includes(e.target.value));
      });

      // Acompanhamento especial
      $('#acompanhamento').addEventListener('change', (e) => {
        $('#acompanhamentoExtra').classList.toggle('hidden', !e.target.checked);
      });

      // Bot√µes
      $('#btnNovo').addEventListener('click', (e) => {
        e.preventDefault();
        limparCadastro();
      });

      $('#btnSalvar').addEventListener('click', (e) => {
        e.preventDefault();
        salvarCrianca();
      });


    }

    function limparCadastro() {
      $('#childId').value = '';
      $('#nome').value = '';
      $('#cpf').value = '';
      $('#nascimento').value = '';
      $('#escola').value = '';
      $('#turmaSelect').value = '';
      $('#idInterno').value = '';
      $('#nomeResp').value = '';
      $('#contatoResp').value = '';
      $('#parentesco').value = '';
      $('#condicaoMedica').value = 'normal';
      $('#alergias').value = '';
      $('#obsMedicas').value = '';
      $('#acompanhamento').checked = false;
      $('#tipoAcompanhamento').value = '';
      $('#obsAcompanhamento').value = '';
      
      // Limpar alertas
      $('#alertaMedico').classList.add('hidden');
      $('#acompanhamentoExtra').classList.add('hidden');
      
      // Limpar erros
      $('#cpfError').classList.add('hidden');
      $('#idadeError').classList.add('hidden');
      $('#contatoError').classList.add('hidden');
      $('#cpf').classList.remove('border-red-500');
      $('#nascimento').classList.remove('border-red-500');
      $('#contatoResp').classList.remove('border-red-500');
    }

    function preencherCadastro(crianca) {
      $('#childId').value = crianca.id;
      $('#nome').value = crianca.nome || '';
      $('#cpf').value = crianca.cpf || '';
      $('#nascimento').value = crianca.nascimento || '';
      $('#escola').value = crianca.escola || '';
      $('#turmaSelect').value = crianca.turma || '';
      $('#idInterno').value = crianca.id || '';
      $('#nomeResp').value = crianca.nomeResp || '';
      $('#contatoResp').value = crianca.contatoResp || '';
      $('#parentesco').value = crianca.parentesco || '';
      $('#condicaoMedica').value = crianca.condicaoMedica || 'normal';
      $('#alergias').value = crianca.alergias || '';
      $('#obsMedicas').value = crianca.obsMedicas || '';
      $('#acompanhamento').checked = crianca.acompanhamento || false;
      $('#tipoAcompanhamento').value = crianca.tipoAcompanhamento || '';
      $('#obsAcompanhamento').value = crianca.obsAcompanhamento || '';
      
      // Mostrar/ocultar se√ß√µes
      const condicoesCriticas = ['asma', 'diabetes', 'epilepsia', 'cardiopatia'];
      $('#alertaMedico').classList.toggle('hidden', !condicoesCriticas.includes(crianca.condicaoMedica));
      $('#acompanhamentoExtra').classList.toggle('hidden', !crianca.acompanhamento);
    }

    function salvarCrianca() {
      // Valida√ß√µes b√°sicas
      const nome = $('#nome').value.trim();
      const cpf = $('#cpf').value.replace(/[^\d]/g, '');
      const nascimento = $('#nascimento').value;
      const turma = $('#turmaSelect').value;
      const nomeResp = $('#nomeResp').value.trim();
      const contatoResp = $('#contatoResp').value.trim();
      const parentesco = $('#parentesco').value;
      
      if (!nome || !cpf || !nascimento || !turma || !nomeResp || !contatoResp || !parentesco) {
        alert('Preencha todos os campos obrigat√≥rios marcados com *');
        return;
      }
      
      // Validar CPF
      if (!validarCPF(cpf)) {
        alert('CPF inv√°lido');
        $('#cpf').focus();
        return;
      }
      
      // Validar idade
      if (!validarIdade(nascimento)) {
        alert('A crian√ßa deve ter entre 7 e 14 anos');
        $('#nascimento').focus();
        return;
      }
      
      // Validar contato
      if (!validarContato(contatoResp)) {
        alert('Formato de contato inv√°lido. Use: (xx) xxxxx-xxxx');
        $('#contatoResp').focus();
        return;
      }
      
      // Verificar CPF duplicado
      const id = $('#childId').value || uid();
      const cpfExistente = state.criancas.find(c => c.id !== id && c.cpf === cpf);
      if (cpfExistente) {
        alert(`CPF j√° cadastrado para: ${cpfExistente.nome}`);
        return;
      }
      
      // Montar objeto da crian√ßa
      const crianca = {
        id,
        nome,
        cpf,
        nascimento,
        escola: $('#escola').value.trim(),
        turma,
        nomeResp,
        contatoResp,
        parentesco,
        condicaoMedica: $('#condicaoMedica').value,
        alergias: $('#alergias').value.trim(),
        obsMedicas: $('#obsMedicas').value.trim(),
        acompanhamento: $('#acompanhamento').checked,
        tipoAcompanhamento: $('#tipoAcompanhamento').value,
        obsAcompanhamento: $('#obsAcompanhamento').value.trim()
      };
      
      // Confirma√ß√£o
      const isEdicao = !!$('#childId').value;
      const mensagem = isEdicao ? 
        `Confirma a atualiza√ß√£o dos dados de ${nome}?` : 
        `Confirma o cadastro de ${nome}?`;
      
      mostrarModal('Confirmar cadastro', mensagem, () => {
        // Salvar
        const idx = state.criancas.findIndex(c => c.id === id);
        if (idx >= 0) {
          state.criancas[idx] = crianca;
        } else {
          state.criancas.push(crianca);
        }
        
        salvarLS();
        renderListaCriancas();
        
        const sucessoMsg = isEdicao ? 'Dados atualizados com sucesso!' : 'Cadastro realizado com sucesso!';
        alert(sucessoMsg);
        
        if (!isEdicao) {
          limparCadastro();
        }
      });
    }





    // GERENCIAR ALUNOS
    function setupGerenciar() {
      $('#buscaGerenciar').addEventListener('input', (e) => renderListaGerenciar(e.target.value));
      $('#filtroTurmaGerenciar').addEventListener('change', () => renderListaGerenciar());
      $('#filtroStatus').addEventListener('change', () => renderListaGerenciar());
      $('#btnExportarGerenciar').addEventListener('click', exportarListaGerenciar);
    }

    function renderListaGerenciar(filtro = '') {
      const tbody = $('#listaAlunosGerenciar');
      const termo = filtro.trim().toLowerCase();
      const turmaFiltro = $('#filtroTurmaGerenciar')?.value || '';
      const statusFiltro = $('#filtroStatus')?.value || '';
      
      let lista = state.criancas.filter(c => {
        const matchTermo = !termo || [
          c.nome,
          c.cpf,
          c.nomeResp
        ].some(x => (x || '').toLowerCase().includes(termo));
        
        const matchTurma = !turmaFiltro || c.turma === turmaFiltro;
        
        let matchStatus = true;
        if (statusFiltro) {
          const condicoesCriticas = ['asma', 'diabetes', 'epilepsia', 'cardiopatia'];
          const temAlertaMedico = condicoesCriticas.includes(c.condicaoMedica);
          const temAcompanhamento = c.acompanhamento;
          
          switch(statusFiltro) {
            case 'medico':
              matchStatus = temAlertaMedico;
              break;
            case 'pedagogico':
              matchStatus = temAcompanhamento;
              break;
            case 'normal':
              matchStatus = !temAlertaMedico && !temAcompanhamento;
              break;
          }
        }
        
        return matchTermo && matchTurma && matchStatus;
      });
      
      lista.sort((a, b) => a.nome.localeCompare(b.nome));
      
      tbody.innerHTML = '';
      
      if (lista.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="p-3 text-center text-slate-500">Nenhum aluno encontrado</td></tr>';
        return;
      }
      
      for (const c of lista) {
        const turmaLabel = {
          'turma-a': 'Turma A - Manh√£',
          'turma-b': 'Turma B - Tarde',
          'turma-c': 'Turma C - Integral'
        }[c.turma] || 'Sem turma';
        
        const condicoesCriticas = ['asma', 'diabetes', 'epilepsia', 'cardiopatia'];
        const temAlertaMedico = condicoesCriticas.includes(c.condicaoMedica);
        const temAcompanhamento = c.acompanhamento;
        
        let statusBadges = [];
        if (temAlertaMedico) {
          statusBadges.push('<span class="px-2 py-1 rounded-full text-xs bg-red-100 text-red-700 border border-red-200">‚ö†Ô∏è M√©dico</span>');
        }
        if (temAcompanhamento) {
          statusBadges.push('<span class="px-2 py-1 rounded-full text-xs bg-purple-100 text-purple-700 border border-purple-200">üìö Pedag√≥gico</span>');
        }
        if (statusBadges.length === 0) {
          statusBadges.push('<span class="px-2 py-1 rounded-full text-xs bg-green-100 text-green-700 border border-green-200">Normal</span>');
        }
        
        const tr = document.createElement('tr');
        tr.className = 'border-t hover:bg-slate-50';
        tr.innerHTML = `
          <td class="p-3">
            <div class="font-medium">${c.nome}</div>
            <div class="text-xs text-slate-500">ID: ${c.id}</div>
          </td>
          <td class="p-3">${c.cpf ? formatarCPF(c.cpf) : '-'}</td>
          <td class="p-3">${turmaLabel}</td>
          <td class="p-3">${c.nomeResp || '-'}</td>
          <td class="p-3">${c.contatoResp || '-'}</td>
          <td class="p-3">
            <div class="flex flex-wrap gap-1">
              ${statusBadges.join('')}
            </div>
          </td>
          <td class="p-3">
            <div class="flex gap-2">
              <button data-id="${c.id}" class="btn-editar-gerenciar px-3 py-1 rounded-md bg-blue-500 hover:bg-blue-600 text-white text-xs">Editar</button>
              <button data-id="${c.id}" class="btn-remover-gerenciar px-3 py-1 rounded-md bg-red-500 hover:bg-red-600 text-white text-xs">Remover</button>
            </div>
          </td>
        `;
        tbody.appendChild(tr);
      }
      
      // Event listeners
      $$('.btn-editar-gerenciar').forEach(b => {
        b.addEventListener('click', () => {
          const c = state.criancas.find(x => x.id === b.dataset.id);
          if (c) {
            // Ir para a aba de cadastro e preencher os dados
            const sections = ['presencas', 'cadastro', 'gerenciar', 'comunicacao', 'relatorios', 'dashboard'];
            sections.forEach(s => {
              const el = document.getElementById(s);
              if (el) el.classList.toggle('hidden', s !== 'cadastro');
            });
            
            $$('.nav-btn').forEach(btn => btn.classList.remove('bg-[#E11D48]', 'text-white'));
            const activeBtn = [...$$('.nav-btn')].find(btn => btn.dataset.section === 'cadastro');
            if (activeBtn) activeBtn.classList.add('bg-[#E11D48]', 'text-white');
            
            preencherCadastro(c);
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }
        });
      });
      
      $$('.btn-remover-gerenciar').forEach(b => {
        b.addEventListener('click', () => {
          const id = b.dataset.id;
          const c = state.criancas.find(x => x.id === id);
          if (!c) return;
          
          mostrarModal('Confirmar remo√ß√£o', `Remover ${c.nome}? Esta a√ß√£o n√£o pode ser desfeita.`, () => {
            state.criancas = state.criancas.filter(x => x.id !== id);
            // Remover presen√ßas relacionadas
            state.presencas = state.presencas.filter(p => p.childId !== id);
            
            salvarLS();
            renderListaGerenciar();
            alert('Aluno removido com sucesso!');
          });
        });
      });
    }

    function exportarListaGerenciar() {
      const rows = [
        ['ID', 'Nome', 'CPF', 'Nascimento', 'Turma', 'Escola', 'Respons√°vel', 'Contato', 'Condi√ß√£o M√©dica', 'Acompanhamento']
      ];
      
      for (const c of state.criancas) {
        const turmaLabel = {
          'turma-a': 'Turma A - Manh√£',
          'turma-b': 'Turma B - Tarde',
          'turma-c': 'Turma C - Integral'
        }[c.turma] || '';
        
        rows.push([
          c.id,
          c.nome,
          c.cpf ? formatarCPF(c.cpf) : '',
          c.nascimento,
          turmaLabel,
          c.escola || '',
          c.nomeResp || '',
          c.contatoResp || '',
          c.condicaoMedica || 'normal',
          c.acompanhamento ? 'Sim' : 'N√£o'
        ]);
      }
      
      downloadCSV('lista_alunos.csv', rows);
    }

    // COMUNICA√á√ÉO
    function setupComunicacao() {
      // Inicializar dados de comunica√ß√£o se n√£o existirem
      if (!state.mensagens) {
        state.mensagens = [];
        state.conversasEquipe = [
          { id: 'geral', nome: 'Geral', participantes: ['Admin', 'Coordenador', 'Instrutor'] },
          { id: 'coordenacao', nome: 'Coordena√ß√£o', participantes: ['Admin', 'Coordenador'] }
        ];
        state.avisos = [];
        
        // Mensagens de exemplo
        state.mensagens = [
          {
            id: uid(),
            tipo: 'equipe',
            conversa: 'geral',
            remetente: 'Coordenador',
            conteudo: 'Bom dia equipe! Lembrem-se da reuni√£o √†s 14h.',
            timestamp: new Date().toISOString(),
            lida: false
          }
        ];
      }
      
      // Event listeners
      $('#destinatarios').addEventListener('change', (e) => {
        $('#seletorIndividual').classList.toggle('hidden', e.target.value !== 'individual');
        if (e.target.value === 'individual') {
          popularResponsaveis();
        }
      });
      
      $('#formMensagemResp').addEventListener('submit', (e) => {
        e.preventDefault();
        enviarMensagemResponsaveis();
      });
      
      $('#formAviso').addEventListener('submit', (e) => {
        e.preventDefault();
        criarAviso();
      });
      
      $('#btnEnviar').addEventListener('click', enviarMensagemEquipe);
      $('#inputMensagem').addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          enviarMensagemEquipe();
        }
      });
    }

    function setupComunicacaoTabs() {
      const tabs = ['tabEquipe', 'tabResponsaveis', 'tabAvisos'];
      const contents = ['comunicacaoEquipe', 'comunicacaoResponsaveis', 'comunicacaoAvisos'];
      
      tabs.forEach((tabId, index) => {
        $(`#${tabId}`).addEventListener('click', () => {
          // Atualizar abas
          tabs.forEach(t => {
            const tab = $(`#${t}`);
            tab.classList.remove('border-[#E11D48]', 'text-[#E11D48]');
            tab.classList.add('border-transparent', 'text-slate-500');
          });
          
          $(`#${tabId}`).classList.remove('border-transparent', 'text-slate-500');
          $(`#${tabId}`).classList.add('border-[#E11D48]', 'text-[#E11D48]');
          
          // Mostrar conte√∫do
          contents.forEach((contentId, i) => {
            $(`#${contentId}`).classList.toggle('hidden', i !== index);
          });
        });
      });
    }

    function renderComunicacao() {
      renderConversasEquipe();
      renderHistoricoMensagens();
      renderAvisos();
    }

    function renderConversasEquipe() {
      const container = $('#listaConversasEquipe');
      container.innerHTML = '';
      
      state.conversasEquipe.forEach(conversa => {
        const mensagensNaoLidas = state.mensagens.filter(m => 
          m.conversa === conversa.id && !m.lida && m.remetente !== 'Admin'
        ).length;
        
        const div = document.createElement('div');
        div.className = 'p-3 rounded-lg border border-slate-200 hover:bg-slate-50 cursor-pointer';
        div.dataset.conversa = conversa.id;
        div.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="font-medium">${conversa.nome}</div>
            ${mensagensNaoLidas > 0 ? 
              `<span class="px-2 py-1 rounded-full bg-red-500 text-white text-xs">${mensagensNaoLidas}</span>` : 
              ''
            }
          </div>
          <div class="text-sm text-slate-500">${conversa.participantes.join(', ')}</div>
        `;
        
        div.addEventListener('click', () => abrirConversa(conversa.id, conversa.nome));
        container.appendChild(div);
      });
    }

    function abrirConversa(conversaId, conversaNome) {
      state.conversaAtual = conversaId;
      $('#chatTitulo').textContent = conversaNome;
      $('#inputMensagem').disabled = false;
      $('#btnEnviar').disabled = false;
      
      renderMensagensConversa(conversaId);
      
      // Marcar mensagens como lidas
      state.mensagens.forEach(m => {
        if (m.conversa === conversaId && m.remetente !== 'Admin') {
          m.lida = true;
        }
      });
      
      salvarLS();
      renderConversasEquipe();
    }

    function renderMensagensConversa(conversaId) {
      const container = $('#chatMensagens');
      const mensagens = state.mensagens.filter(m => m.conversa === conversaId);
      
      container.innerHTML = '';
      
      if (mensagens.length === 0) {
        container.innerHTML = '<div class="text-center text-slate-500 py-8">Nenhuma mensagem ainda</div>';
        return;
      }
      
      mensagens.forEach(msg => {
        const isOwn = msg.remetente === 'Admin';
        const div = document.createElement('div');
        div.className = `flex ${isOwn ? 'justify-end' : 'justify-start'}`;
        
        const time = new Date(msg.timestamp).toLocaleTimeString('pt-BR', { 
          hour: '2-digit', 
          minute: '2-digit' 
        });
        
        div.innerHTML = `
          <div class="max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${
            isOwn ? 
            'bg-[#E11D48] text-white' : 
            'bg-slate-100 text-slate-900'
          }">
            <div class="text-sm">${msg.conteudo}</div>
            <div class="text-xs opacity-70 mt-1">${msg.remetente} ‚Ä¢ ${time}</div>
          </div>
        `;
        
        container.appendChild(div);
      });
      
      container.scrollTop = container.scrollHeight;
    }

    function enviarMensagemEquipe() {
      const conteudo = $('#inputMensagem').value.trim();
      if (!conteudo || !state.conversaAtual) return;
      
      const mensagem = {
        id: uid(),
        tipo: 'equipe',
        conversa: state.conversaAtual,
        remetente: 'Admin',
        conteudo,
        timestamp: new Date().toISOString(),
        lida: true
      };
      
      state.mensagens.push(mensagem);
      $('#inputMensagem').value = '';
      
      salvarLS();
      renderMensagensConversa(state.conversaAtual);
    }

    function popularResponsaveis() {
      const select = $('#responsavelIndividual');
      select.innerHTML = '<option value="">Escolha um respons√°vel</option>';
      
      state.criancas.forEach(c => {
        if (c.nomeResp) {
          const option = document.createElement('option');
          option.value = c.id;
          option.textContent = `${c.nomeResp} (${c.nome})`;
          select.appendChild(option);
        }
      });
    }

    function enviarMensagemResponsaveis() {
      const destinatarios = $('#destinatarios').value;
      const assunto = $('#assuntoMsg').value.trim();
      const conteudo = $('#conteudoMsg').value.trim();
      const urgente = $('#urgente').checked;
      
      if (!assunto || !conteudo) {
        alert('Preencha o assunto e a mensagem');
        return;
      }
      
      let destinatariosList = [];
      
      switch(destinatarios) {
        case 'todos':
          destinatariosList = state.criancas.map(c => ({ nome: c.nomeResp, crianca: c.nome }));
          break;
        case 'turma-a':
        case 'turma-b':
        case 'turma-c':
          destinatariosList = state.criancas
            .filter(c => c.turma === destinatarios)
            .map(c => ({ nome: c.nomeResp, crianca: c.nome }));
          break;
        case 'individual':
          const criancaId = $('#responsavelIndividual').value;
          const crianca = state.criancas.find(c => c.id === criancaId);
          if (crianca) {
            destinatariosList = [{ nome: crianca.nomeResp, crianca: crianca.nome }];
          }
          break;
      }
      
      const mensagem = {
        id: uid(),
        tipo: 'responsaveis',
        destinatarios: destinatariosList,
        assunto,
        conteudo,
        urgente,
        timestamp: new Date().toISOString(),
        remetente: 'Admin'
      };
      
      state.mensagens.push(mensagem);
      
      // Limpar formul√°rio
      $('#assuntoMsg').value = '';
      $('#conteudoMsg').value = '';
      $('#urgente').checked = false;
      $('#destinatarios').value = 'todos';
      $('#seletorIndividual').classList.add('hidden');
      
      salvarLS();
      renderHistoricoMensagens();
      alert(`Mensagem enviada para ${destinatariosList.length} respons√°vel(is)!`);
    }

    function renderHistoricoMensagens() {
      const container = $('#historicoMensagens');
      const mensagensResp = state.mensagens.filter(m => m.tipo === 'responsaveis');
      
      container.innerHTML = '';
      
      if (mensagensResp.length === 0) {
        container.innerHTML = '<div class="text-center text-slate-500 py-4">Nenhuma mensagem enviada</div>';
        return;
      }
      
      mensagensResp.reverse().forEach(msg => {
        const div = document.createElement('div');
        div.className = 'p-3 border border-slate-200 rounded-lg';
        
        const data = new Date(msg.timestamp).toLocaleDateString('pt-BR');
        const hora = new Date(msg.timestamp).toLocaleTimeString('pt-BR', { 
          hour: '2-digit', 
          minute: '2-digit' 
        });
        
        div.innerHTML = `
          <div class="flex items-center justify-between mb-2">
            <div class="font-medium">${msg.assunto}</div>
            ${msg.urgente ? '<span class="px-2 py-1 rounded-full bg-red-100 text-red-700 text-xs">Urgente</span>' : ''}
          </div>
          <div class="text-sm text-slate-600 mb-2">${msg.conteudo}</div>
          <div class="text-xs text-slate-500">
            ${data} √†s ${hora} ‚Ä¢ ${msg.destinatarios.length} destinat√°rio(s)
          </div>
        `;
        
        container.appendChild(div);
      });
    }

    function criarAviso() {
      const tipo = $('#tipoAviso').value;
      const titulo = $('#tituloAviso').value.trim();
      const conteudo = $('#conteudoAviso').value.trim();
      const validade = $('#validadeAviso').value;
      
      if (!titulo || !conteudo) {
        alert('Preencha o t√≠tulo e o conte√∫do do aviso');
        return;
      }
      
      const aviso = {
        id: uid(),
        tipo,
        titulo,
        conteudo,
        validade: validade || null,
        timestamp: new Date().toISOString(),
        ativo: true
      };
      
      state.avisos.push(aviso);
      
      // Limpar formul√°rio
      $('#tituloAviso').value = '';
      $('#conteudoAviso').value = '';
      $('#validadeAviso').value = '';
      $('#tipoAviso').value = 'informativo';
      
      salvarLS();
      renderAvisos();
      alert('Aviso publicado com sucesso!');
    }

    function renderAvisos() {
      const container = $('#listaAvisos');
      const avisosAtivos = state.avisos.filter(a => {
        if (!a.ativo) return false;
        if (a.validade) {
          return new Date(a.validade) >= new Date();
        }
        return true;
      });
      
      container.innerHTML = '';
      
      if (avisosAtivos.length === 0) {
        container.innerHTML = '<div class="text-center text-slate-500 py-4">Nenhum aviso ativo</div>';
        return;
      }
      
      avisosAtivos.reverse().forEach(aviso => {
        const div = document.createElement('div');
        div.className = 'p-3 border border-slate-200 rounded-lg';
        
        const tipoColors = {
          'informativo': 'bg-blue-100 text-blue-700',
          'importante': 'bg-yellow-100 text-yellow-700',
          'urgente': 'bg-red-100 text-red-700',
          'evento': 'bg-green-100 text-green-700'
        };
        
        const data = new Date(aviso.timestamp).toLocaleDateString('pt-BR');
        
        div.innerHTML = `
          <div class="flex items-center justify-between mb-2">
            <div class="font-medium">${aviso.titulo}</div>
            <div class="flex gap-2">
              <span class="px-2 py-1 rounded-full text-xs ${tipoColors[aviso.tipo]}">${aviso.tipo}</span>
              <button data-id="${aviso.id}" class="btn-remover-aviso px-2 py-1 rounded text-xs bg-red-500 hover:bg-red-600 text-white">Remover</button>
            </div>
          </div>
          <div class="text-sm text-slate-600 mb-2">${aviso.conteudo}</div>
          <div class="text-xs text-slate-500">
            Publicado em ${data}
            ${aviso.validade ? ` ‚Ä¢ V√°lido at√© ${new Date(aviso.validade).toLocaleDateString('pt-BR')}` : ''}
          </div>
        `;
        
        container.appendChild(div);
      });
      
      // Event listeners para remover avisos
      $$('.btn-remover-aviso').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          mostrarModal('Remover aviso', 'Tem certeza que deseja remover este aviso?', () => {
            state.avisos = state.avisos.filter(a => a.id !== id);
            salvarLS();
            renderAvisos();
          });
        });
      });
    }

    // RELAT√ìRIOS
    function setupRelatorios() {
      $('#btnGerarRelatorio').addEventListener('click', gerarRelatorio);
      $('#btnExportRelatorio').addEventListener('click', exportarRelatorio);
    }

    function gerarRelatorio() {
      const tipo = $('#tipoRelatorio').value;
      const inicio = $('#dataInicio').value || '2000-01-01';
      const fim = $('#dataFim').value || '2099-12-31';
      const turma = $('#relTurma').value;
      
      let dados = [];
      let colunas = [];
      
      switch (tipo) {
        case 'presencas':
          dados = gerarRelatorioPresencas(inicio, fim, turma);
          colunas = ['Data', 'Crian√ßa', 'Turma', 'Status', 'Observa√ß√µes'];
          break;
        case 'individual':
          dados = gerarRelatorioIndividual(inicio, fim);
          colunas = ['Crian√ßa', 'Total Dias', 'Presen√ßas', 'Faltas', 'Taxa %'];
          break;
        case 'turma':
          dados = gerarRelatorioPorTurma(inicio, fim);
          colunas = ['Turma', 'Total Alunos', 'Taxa Presen√ßa', 'Alertas'];
          break;
        case 'medico':
          dados = gerarRelatorioMedico();
          colunas = ['Crian√ßa', 'Condi√ß√£o', 'Alergias', 'Observa√ß√µes'];
          break;
      }
      
      renderTabelaRelatorio(colunas, dados);
    }

    function gerarRelatorioPresencas(inicio, fim, turmaFiltro) {
      return state.presencas
        .filter(p => {
          const matchData = p.data >= inicio && p.data <= fim;
          
          let matchTurma = true;
          if (turmaFiltro) {
            const crianca = state.criancas.find(c => c.id === p.childId);
            matchTurma = crianca && crianca.turma === turmaFiltro;
          }
          
          return matchData && matchTurma;
        })
        .map(p => {
          const crianca = state.criancas.find(c => c.id === p.childId);
          const turmaLabel = {
            'turma-a': 'Turma A - Manh√£',
            'turma-b': 'Turma B - Tarde',
            'turma-c': 'Turma C - Integral'
          }[crianca?.turma] || 'Sem turma';
          
          return [
            p.data,
            crianca?.nome || 'Desconhecida',
            turmaLabel,
            p.status,
            p.observacoes || '-'
          ];
        })
        .sort((a, b) => b[0].localeCompare(a[0]));
    }

    function gerarRelatorioIndividual(inicio, fim) {
      return state.criancas.map(crianca => {
        const presencas = state.presencas.filter(p => 
          p.childId === crianca.id && 
          p.data >= inicio && 
          p.data <= fim
        );
        
        const totalDias = presencas.length;
        const totalPresencas = presencas.filter(p => p.status === 'presente').length;
        const totalFaltas = presencas.filter(p => p.status === 'falta').length;
        const taxa = totalDias > 0 ? Math.round((totalPresencas / totalDias) * 100) : 0;
        
        return [
          crianca.nome,
          totalDias,
          totalPresencas,
          totalFaltas,
          `${taxa}%`
        ];
      });
    }

    function gerarRelatorioPorTurma(inicio, fim) {
      const turmas = [
        { id: 'turma-a', nome: 'Turma A - Manh√£' },
        { id: 'turma-b', nome: 'Turma B - Tarde' },
        { id: 'turma-c', nome: 'Turma C - Integral' }
      ];
      
      return turmas.map(turma => {
        const alunosDaTurma = state.criancas.filter(c => c.turma === turma.id);
        const alertas = alunosDaTurma.filter(c => 
          ['asma', 'diabetes', 'epilepsia', 'cardiopatia'].includes(c.condicaoMedica) ||
          c.acompanhamento
        ).length;
        
        // Calcular taxa de presen√ßa da turma
        const presencasTurma = state.presencas.filter(p => {
          const crianca = state.criancas.find(c => c.id === p.childId);
          return crianca && crianca.turma === turma.id && 
                 p.data >= inicio && p.data <= fim;
        });
        
        const totalPresencas = presencasTurma.filter(p => p.status === 'presente').length;
        const totalDias = presencasTurma.length;
        const taxa = totalDias > 0 ? Math.round((totalPresencas / totalDias) * 100) : 0;
        
        return [
          turma.nome,
          alunosDaTurma.length,
          `${taxa}%`,
          alertas
        ];
      });
    }

    function gerarRelatorioMedico() {
      return state.criancas
        .filter(c => c.condicaoMedica !== 'normal' || c.acompanhamento)
        .map(c => [
          c.nome,
          c.condicaoMedica || 'normal',
          c.alergias || '-',
          c.obsMedicas || c.obsAcompanhamento || '-'
        ]);
    }

    function renderTabelaRelatorio(colunas, dados) {
      const container = $('#relatorioConteudo');
      
      if (dados.length === 0) {
        container.innerHTML = '<div class="text-center py-8 text-slate-500">Nenhum dado encontrado para os filtros selecionados</div>';
        return;
      }
      
      const table = document.createElement('table');
      table.className = 'w-full border border-slate-200 rounded-xl overflow-hidden';
      
      // Cabe√ßalho
      const thead = document.createElement('thead');
      thead.className = 'bg-slate-50';
      const headerRow = document.createElement('tr');
      headerRow.className = 'text-left text-sm';
      
      colunas.forEach(col => {
        const th = document.createElement('th');
        th.className = 'p-3';
        th.textContent = col;
        headerRow.appendChild(th);
      });
      
      thead.appendChild(headerRow);
      table.appendChild(thead);
      
      // Corpo
      const tbody = document.createElement('tbody');
      tbody.className = 'text-sm';
      
      dados.forEach(row => {
        const tr = document.createElement('tr');
        tr.className = 'border-t';
        
        row.forEach(cell => {
          const td = document.createElement('td');
          td.className = 'p-3';
          td.textContent = cell;
          tr.appendChild(td);
        });
        
        tbody.appendChild(tr);
      });
      
      table.appendChild(tbody);
      container.innerHTML = '';
      container.appendChild(table);
    }

    function exportarRelatorio() {
      const tipo = $('#tipoRelatorio').value;
      const inicio = $('#dataInicio').value || '2000-01-01';
      const fim = $('#dataFim').value || '2099-12-31';
      const turma = $('#relTurma').value;
      
      let dados = [];
      let colunas = [];
      let filename = 'relatorio.csv';
      
      switch (tipo) {
        case 'presencas':
          dados = gerarRelatorioPresencas(inicio, fim, turma);
          colunas = ['Data', 'Crian√ßa', 'Turma', 'Status', 'Observa√ß√µes'];
          filename = 'relatorio_presencas.csv';
          break;
        case 'individual':
          dados = gerarRelatorioIndividual(inicio, fim);
          colunas = ['Crian√ßa', 'Total Dias', 'Presen√ßas', 'Faltas', 'Taxa %'];
          filename = 'relatorio_individual.csv';
          break;
        case 'turma':
          dados = gerarRelatorioPorTurma(inicio, fim);
          colunas = ['Turma', 'Total Alunos', 'Taxa Presen√ßa', 'Alertas'];
          filename = 'relatorio_turmas.csv';
          break;
        case 'medico':
          dados = gerarRelatorioMedico();
          colunas = ['Crian√ßa', 'Condi√ß√£o', 'Alergias', 'Observa√ß√µes'];
          filename = 'relatorio_medico.csv';
          break;
      }
      
      const rows = [colunas, ...dados];
      downloadCSV(filename, rows);
    }

    // DASHBOARD
    function setupDashboard() {
      $('#btnAtualizarDash').addEventListener('click', atualizarDashboard);
    }

    function atualizarDashboard() {
      // KPIs
      const totalAlunos = state.criancas.length;
      $('#totalAlunos').textContent = totalAlunos;
      
      const alertasMedicos = state.criancas.filter(c => 
        ['asma', 'diabetes', 'epilepsia', 'cardiopatia'].includes(c.condicaoMedica)
      ).length;
      $('#alertasMedicos').textContent = alertasMedicos;
      
      const acompanhamentoEspecial = state.criancas.filter(c => c.acompanhamento).length;
      $('#acompanhamentoEspecial').textContent = acompanhamentoEspecial;
      
      // Taxa de presen√ßa (√∫ltimos 30 dias)
      const hoje = new Date();
      const trintaDiasAtras = new Date(hoje);
      trintaDiasAtras.setDate(trintaDiasAtras.getDate() - 30);
      
      const presencasRecentes = state.presencas.filter(p => 
        new Date(p.data) >= trintaDiasAtras
      );
      
      const totalPresencas = presencasRecentes.filter(p => p.status === 'presente').length;
      const totalDias = presencasRecentes.length;
      const taxaPresenca = totalDias > 0 ? Math.round((totalPresencas / totalDias) * 100) : 0;
      
      $('#presencaMedia').textContent = `${taxaPresenca}%`;
      
      // Resumo por turma
      renderResumoTurmas();
      
      // √öltimas atividades
      renderUltimasAtividades();
    }

    function renderResumoTurmas() {
      const container = $('#resumoTurmas');
      const turmas = [
        { id: 'turma-a', nome: 'Turma A - Manh√£' },
        { id: 'turma-b', nome: 'Turma B - Tarde' },
        { id: 'turma-c', nome: 'Turma C - Integral' }
      ];
      
      container.innerHTML = '';
      
      turmas.forEach(turma => {
        const alunos = state.criancas.filter(c => c.turma === turma.id);
        const alertas = alunos.filter(c => 
          ['asma', 'diabetes', 'epilepsia', 'cardiopatia'].includes(c.condicaoMedica) ||
          c.acompanhamento
        ).length;
        
        const div = document.createElement('div');
        div.className = 'flex items-center justify-between p-3 bg-slate-50 rounded-lg';
        div.innerHTML = `
          <div>
            <div class="font-medium">${turma.nome}</div>
            <div class="text-sm text-slate-500">${alunos.length} alunos</div>
          </div>
          <div class="text-right">
            ${alertas > 0 ? 
              `<div class="text-sm text-red-600">${alertas} alertas</div>` :
              '<div class="text-sm text-green-600">Sem alertas</div>'
            }
          </div>
        `;
        container.appendChild(div);
      });
    }

    function renderUltimasAtividades() {
      const container = $('#ultimasAtividades');
      
      // Pegar √∫ltimas presen√ßas
      const ultimasPresencas = [...state.presencas]
        .sort((a, b) => b.data.localeCompare(a.data))
        .slice(0, 5);
      
      container.innerHTML = '';
      
      if (ultimasPresencas.length === 0) {
        container.innerHTML = '<div class="text-center text-slate-500 py-4">Nenhuma atividade recente</div>';
        return;
      }
      
      ultimasPresencas.forEach(p => {
        const crianca = state.criancas.find(c => c.id === p.childId);
        
        const div = document.createElement('div');
        div.className = 'flex items-center justify-between p-3 bg-slate-50 rounded-lg';
        div.innerHTML = `
          <div>
            <div class="font-medium">${crianca?.nome || 'Desconhecida'}</div>
            <div class="text-sm text-slate-500">${p.data}</div>
          </div>
          <div class="text-right">
            <span class="px-2 py-1 rounded-full text-xs ${
              p.status === 'presente' ? 'bg-green-100 text-green-700' :
              p.status === 'atraso' ? 'bg-yellow-100 text-yellow-700' :
              'bg-red-100 text-red-700'
            }">
              ${p.status}
            </span>
          </div>
        `;
        container.appendChild(div);
      });
    }

    // MODAL
    function setupModal() {
      $('#btnCancelar').addEventListener('click', () => {
        $('#modalConfirmacao').classList.add('hidden');
        state.currentAction = null;
      });
      
      $('#btnConfirmar').addEventListener('click', () => {
        if (state.currentAction) {
          state.currentAction();
        }
        $('#modalConfirmacao').classList.add('hidden');
        state.currentAction = null;
      });
    }

    function mostrarModal(titulo, mensagem, acao) {
      $('#tituloModal').textContent = titulo;
      $('#mensagemModal').textContent = mensagem;
      state.currentAction = acao;
      $('#modalConfirmacao').classList.remove('hidden');
    }

    // UTILIT√ÅRIOS
    function downloadCSV(filename, rows) {
      const csvContent = rows.map(row => 
        row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')
      ).join('\n');
      
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      
      if (link.download !== undefined) {
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', filename);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    }

    // INICIALIZA√á√ÉO DO SISTEMA
    function initSystem() {
      carregarLS();
      setupNav();
      setupPresencas();
      setupCadastro();
      setupGerenciar();
      setupComunicacao();
      setupRelatorios();
      setupDashboard();
      setupModal();
      
      // Definir data padr√£o para hoje
      const hoje = new Date().toISOString().slice(0, 10);
      $('#dataPresenca').value = hoje;
      $('#dataInicio').value = hoje;
      $('#dataFim').value = hoje;
    }

    // Iniciar aplica√ß√£o
    document.addEventListener('DOMContentLoaded', () => {
      setupLogin();
    });
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98da57ea32fb2ebe',t:'MTc2MDMxMTM5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
