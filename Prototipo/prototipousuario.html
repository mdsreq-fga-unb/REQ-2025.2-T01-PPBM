<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prototipo Usuario ‚Äî Bombeiro Mirim</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    html { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    html, body { scroll-behavior: smooth; }

    @media print {
      body { background: #fff !important; }
      #app, #header, #sidebar { display: none !important; }
      #print-area { display: block !important; }
    }
    #print-area { display: none; }

    .soft-shadow { box-shadow: 0 10px 30px rgba(0,0,0,.08), 0 6px 10px rgba(0,0,0,.06); }
    .modal-overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
    
    .floating-animation {
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-white via-slate-50 to-slate-100 text-slate-900">
  
  <!-- Tela de Login -->
  <div id="loginScreen" class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 flex items-center justify-center p-4">
    <div class="w-full max-w-md">
      <!-- Logo e T√≠tulo -->
      <div class="text-center mb-8">
        <div class="inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-gradient-to-br from-[#E11D48] to-[#BE123C] mb-4 floating-animation soft-shadow">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" class="text-white">
            <path d="M12 2l3 3 4 1-1 4 2 3-2 3 1 4-4 1-3 3-3-3-4-1 1-4-2-3 2-3-1-4 4-1 3-3z" fill="currentColor" opacity=".2"/>
            <path d="M12 6a6 6 0 016 6v6H6v-6a6 6 0 016-6z" stroke="currentColor" stroke-width="1.5" opacity=".8"/>
            <circle cx="12" cy="13" r="2.5" fill="currentColor" opacity=".8"/>
          </svg>
        </div>
        <h1 class="text-3xl font-bold text-slate-900 mb-2">Bombeiro Mirim</h1>
        <p class="text-slate-600">Sistema de Gest√£o v8.1</p>
      </div>

      <!-- Formul√°rio de Login -->
      <div class="bg-white rounded-3xl p-8 soft-shadow border border-slate-200">
        <form id="loginForm" class="space-y-6">
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">Usu√°rio</label>
            <input 
              id="loginUser" 
              type="text" 
              required 
              class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48] focus:border-transparent transition"
              placeholder="Digite seu usu√°rio"
              value="marcos.pereira"
            />
          </div>
          
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-2">Senha</label>
            <input 
              id="loginPassword" 
              type="password" 
              required 
              class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48] focus:border-transparent transition"
              placeholder="Digite sua senha"
              value="123456"
            />
          </div>
          
          <div class="flex items-center">
            <input id="rememberMe" type="checkbox" class="w-4 h-4 accent-[#E11D48]" />
            <label for="rememberMe" class="ml-2 text-sm text-slate-600">Lembrar de mim</label>
          </div>
          
          <button 
            type="submit" 
            class="w-full py-3 px-4 rounded-xl bg-[#E11D48] hover:bg-[#BE123C] text-white font-medium transition transform hover:scale-[1.02] active:scale-[0.98]"
          >
            Entrar no Sistema
          </button>
        </form>
        
        <div class="mt-6 pt-6 border-t border-slate-200">
          <div class="text-center text-sm text-slate-500">
            <p>Credenciais de Exemplo:</p>
            <p class="font-mono bg-slate-100 px-2 py-1 rounded mt-1">marcos.pereira / 123456</p>
            <p class="font-mono bg-slate-100 px-2 py-1 rounded mt-1">paula.santos / 123456</p>
          </div>
        </div>
      </div>
      
      <!-- Rodap√© -->
      <div class="text-center mt-8 text-slate-500 text-sm">
        <p>¬© 2024 Corpo de Bombeiros - Sistema Interno</p>
      </div>
    </div>
  </div>

  <!-- Sistema Principal -->
  <div id="app" class="min-h-screen hidden">
    <!-- Header -->
    <header id="header" class="sticky top-0 z-30 backdrop-blur bg-white/80 border-b border-slate-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center gap-4">
        <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-[#E11D48]/10 text-[#E11D48] soft-shadow">
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none" class="drop-shadow">
            <path d="M12 2l3 3 4 1-1 4 2 3-2 3 1 4-4 1-3 3-3-3-4-1 1-4-2-3 2-3-1-4 4-1 3-3z" fill="currentColor" opacity=".15"/>
            <path d="M12 6a6 6 0 016 6v6H6v-6a6 6 0 016-6z" stroke="currentColor" stroke-width="1.5" opacity=".6"/>
            <circle cx="12" cy="13" r="2.2" fill="currentColor" opacity=".6"/>
          </svg>
        </div>
        <div class="flex-1">
          <h1 class="text-xl sm:text-2xl font-bold tracking-tight text-slate-900">Portal do Respons√°vel</h1>
          <p class="text-slate-500 text-sm" id="headerSubtitle">Programa Bombeiro Mirim</p>
        </div>
        <div class="flex items-center gap-3">
          <div class="hidden md:flex items-center gap-2">
            <span class="px-3 py-1 rounded-full bg-green-100 text-green-700 text-xs border border-green-200">Sistema Ativo</span>
            <span class="px-3 py-1 rounded-full bg-[#E11D48]/10 text-[#BE123C] text-xs border border-[#E11D48]/20" id="userInfo">Respons√°vel</span>
          </div>
          <button id="btnLogout" class="px-3 py-2 rounded-lg bg-slate-900 hover:bg-slate-800 text-white text-sm transition">
            Sair
          </button>
        </div>
      </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 grid grid-cols-1 lg:grid-cols-[280px,1fr] gap-6">
      <!-- Sidebar -->
      <aside id="sidebar" class="lg:sticky lg:top-20 self-start">
        <nav class="bg-white rounded-2xl p-3 soft-shadow border border-slate-200">
          <ul class="space-y-2">
            <li><button data-section="presencas" class="nav-btn w-full text-left px-4 py-3 rounded-xl bg-[#E11D48] text-white transition flex items-center gap-2">
              <span class="text-lg">üìÖ</span><span>Presen√ßas do Meu Filho</span>
            </button></li>
            <li><button data-section="comunicacao" class="nav-btn w-full text-left px-4 py-3 rounded-xl text-slate-700 hover:bg-slate-50 hover:text-slate-900 transition flex items-center gap-2">
              <span class="text-lg">üí¨</span><span>Comunica√ß√£o</span>
            </button></li>
            <li><button data-section="relatorio" class="nav-btn w-full text-left px-4 py-3 rounded-xl text-slate-700 hover:bg-slate-50 hover:text-slate-900 transition flex items-center gap-2">
              <span class="text-lg">üìä</span><span>Relat√≥rio Individual</span>
            </button></li>
          </ul>
        </nav>
      </aside>

      <!-- Main Sections -->
      <main class="space-y-6">
        <!-- Presen√ßas do Filho -->
        <section id="presencas" class="bg-white rounded-3xl p-6 soft-shadow border border-slate-200">
          <div class="flex flex-col md:flex-row md:items-center gap-3 mb-6">
            <div class="flex-1">
              <h2 class="text-2xl font-bold text-slate-900 mb-1">Presen√ßas do Meu Filho</h2>
              <p class="text-slate-500" id="infoFilho">Acompanhe a frequ√™ncia escolar</p>
            </div>
            <div class="flex flex-col sm:flex-row gap-3">
              <div>
                <label class="block text-sm font-medium mb-1">Per√≠odo</label>
                <select id="periodoUser" class="px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                  <option value="7">√öltimos 7 dias</option>
                  <option value="15">√öltimos 15 dias</option>
                  <option value="30" selected>√öltimos 30 dias</option>
                  <option value="custom">Per√≠odo personalizado</option>
                </select>
              </div>
              <div id="periodoCustom" class="hidden flex gap-2">
                <input id="dataInicioUser" type="date" class="px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" />
                <input id="dataFimUser" type="date" class="px-3 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" />
              </div>
            </div>
          </div>

          <!-- Resumo do Filho -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-4 text-white text-center">
              <div class="text-2xl font-bold" id="totalDiasFilho">0</div>
              <div class="text-sm opacity-90">Total de Dias</div>
            </div>
            <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-4 text-white text-center">
              <div class="text-2xl font-bold" id="presentesFilho">0</div>
              <div class="text-sm opacity-90">Presen√ßas</div>
            </div>
            <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl p-4 text-white text-center">
              <div class="text-2xl font-bold" id="atrasosFilho">0</div>
              <div class="text-sm opacity-90">Atrasos</div>
            </div>
            <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-xl p-4 text-white text-center">
              <div class="text-2xl font-bold" id="faltasFilho">0</div>
              <div class="text-sm opacity-90">Faltas</div>
            </div>
          </div>

          <!-- Taxa de Frequ√™ncia -->
          <div class="bg-slate-50 rounded-xl p-4 mb-6">
            <div class="flex items-center justify-between mb-2">
              <span class="font-medium">Taxa de Frequ√™ncia</span>
              <span class="text-2xl font-bold text-[#E11D48]" id="taxaFrequencia">0%</span>
            </div>
            <div class="w-full bg-slate-200 rounded-full h-3">
              <div id="barraFrequencia" class="bg-gradient-to-r from-[#E11D48] to-[#BE123C] h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
          </div>

          <!-- Hist√≥rico de Presen√ßas -->
          <div class="overflow-x-auto">
            <table class="w-full border border-slate-200 rounded-xl overflow-hidden">
              <thead class="bg-slate-50">
                <tr class="text-left text-sm">
                  <th class="p-4">Data</th>
                  <th class="p-4">Status</th>
                  <th class="p-4">Observa√ß√µes</th>
                </tr>
              </thead>
              <tbody id="tabelaPresencasUser" class="text-sm"></tbody>
            </table>
          </div>
        </section>

        <!-- Comunica√ß√£o -->
        <section id="comunicacao" class="bg-white rounded-3xl p-6 soft-shadow border border-slate-200 hidden">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h2 class="text-2xl font-bold text-slate-900 mb-1">Comunica√ß√£o</h2>
              <p class="text-slate-500">Mensagens e avisos da escola</p>
            </div>
            <button id="btnEnviarMsgUser" class="px-4 py-2 rounded-lg bg-[#E11D48] hover:bg-[#BE123C] text-white transition">Enviar Mensagem</button>
          </div>

          <!-- Abas de Comunica√ß√£o do Usu√°rio -->
          <div class="flex border-b border-slate-200 mb-6">
            <button id="tabMensagensUser" class="tab-btn-user px-4 py-2 border-b-2 border-[#E11D48] text-[#E11D48] font-medium">Mensagens Recebidas</button>
            <button id="tabAvisosUser" class="tab-btn-user px-4 py-2 border-b-2 border-transparent text-slate-500 hover:text-slate-700">Avisos Gerais</button>
            <button id="tabEnviarUser" class="tab-btn-user px-4 py-2 border-b-2 border-transparent text-slate-500 hover:text-slate-700">Enviar Mensagem</button>
          </div>

          <!-- Conte√∫do das Abas do Usu√°rio -->
          <div id="mensagensRecebidas" class="tab-content-user">
            <div class="space-y-4" id="listaMensagensUser">
              <!-- Mensagens ser√£o inseridas aqui -->
            </div>
          </div>

          <div id="avisosGeraisUser" class="tab-content-user hidden">
            <div class="space-y-4" id="listaAvisosUser">
              <!-- Avisos ser√£o inseridos aqui -->
            </div>
          </div>

          <div id="enviarMensagemUser" class="tab-content-user hidden">
            <div class="max-w-2xl">
              <form id="formMensagemUser" class="space-y-4">
                <div>
                  <label class="block text-sm font-medium mb-1">Para</label>
                  <select id="destinatarioUser" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                    <option value="coordenacao">Coordena√ß√£o</option>
                    <option value="professor">Professor da Turma</option>
                    <option value="administracao">Administra√ß√£o</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm font-medium mb-1">Assunto</label>
                  <input id="assuntoUser" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="Ex: D√∫vida sobre atividade, Justificativa de falta..." />
                </div>
                
                <div>
                  <label class="block text-sm font-medium mb-1">Mensagem</label>
                  <textarea id="conteudoUser" rows="6" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" placeholder="Digite sua mensagem aqui..."></textarea>
                </div>
                
                <button type="submit" class="w-full py-3 px-4 rounded-lg bg-[#E11D48] hover:bg-[#BE123C] text-white transition">Enviar Mensagem</button>
              </form>
            </div>
          </div>
        </section>

        <!-- Relat√≥rio Individual -->
        <section id="relatorio" class="bg-white rounded-3xl p-6 soft-shadow border border-slate-200 hidden">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h2 class="text-2xl font-bold text-slate-900 mb-1">Relat√≥rio Individual</h2>
              <p class="text-slate-500" id="infoRelatorioFilho">Desempenho e frequ√™ncia do seu filho</p>
            </div>
            <button id="btnExportarUser" class="px-4 py-2 rounded-lg bg-[#E11D48] hover:bg-[#BE123C] text-white transition">Exportar PDF</button>
          </div>

          <!-- Filtros -->
          <div class="grid md:grid-cols-3 gap-4 mb-6">
            <div>
              <label class="block text-sm font-medium mb-1">Per√≠odo</label>
              <select id="periodoRelatorio" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]">
                <option value="30">√öltimos 30 dias</option>
                <option value="60">√öltimos 60 dias</option>
                <option value="90">√öltimos 90 dias</option>
                <option value="custom">Per√≠odo personalizado</option>
              </select>
            </div>
            <div id="periodoCustomRelatorio" class="hidden">
              <label class="block text-sm font-medium mb-1">Data inicial</label>
              <input id="dataInicioRelatorio" type="date" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" />
            </div>
            <div id="periodoCustomRelatorio2" class="hidden">
              <label class="block text-sm font-medium mb-1">Data final</label>
              <input id="dataFimRelatorio" type="date" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-[#E11D48]" />
            </div>
          </div>

          <!-- Resumo Geral -->
          <div class="grid md:grid-cols-2 gap-6 mb-6">
            <!-- Estat√≠sticas -->
            <div class="bg-slate-50 rounded-xl p-6">
              <h3 class="font-semibold mb-4">Estat√≠sticas do Per√≠odo</h3>
              <div class="space-y-3">
                <div class="flex justify-between">
                  <span>Total de dias letivos:</span>
                  <span class="font-medium" id="totalDiasRel">0</span>
                </div>
                <div class="flex justify-between">
                  <span>Presen√ßas:</span>
                  <span class="font-medium text-green-600" id="presentesRel">0</span>
                </div>
                <div class="flex justify-between">
                  <span>Atrasos:</span>
                  <span class="font-medium text-yellow-600" id="atrasosRel">0</span>
                </div>
                <div class="flex justify-between">
                  <span>Faltas:</span>
                  <span class="font-medium text-red-600" id="faltasRel">0</span>
                </div>
                <hr class="my-2">
                <div class="flex justify-between text-lg">
                  <span class="font-semibold">Taxa de Frequ√™ncia:</span>
                  <span class="font-bold text-[#E11D48]" id="taxaRel">0%</span>
                </div>
              </div>
            </div>

            <!-- Informa√ß√µes da Crian√ßa -->
            <div class="bg-slate-50 rounded-xl p-6">
              <h3 class="font-semibold mb-4">Informa√ß√µes da Crian√ßa</h3>
              <div class="space-y-3" id="infoFilhoRel">
                <!-- Ser√° preenchido dinamicamente -->
              </div>
            </div>
          </div>

          <!-- Gr√°fico de Frequ√™ncia (Simulado) -->
          <div class="bg-slate-50 rounded-xl p-6 mb-6">
            <h3 class="font-semibold mb-4">Frequ√™ncia por Semana</h3>
            <div class="grid grid-cols-7 gap-2 text-center text-sm">
              <div class="font-medium">Seg</div>
              <div class="font-medium">Ter</div>
              <div class="font-medium">Qua</div>
              <div class="font-medium">Qui</div>
              <div class="font-medium">Sex</div>
              <div class="font-medium">S√°b</div>
              <div class="font-medium">Dom</div>
              <!-- Barras do gr√°fico -->
              <div id="graficoFrequencia" class="col-span-7 grid grid-cols-7 gap-2 mt-2">
                <!-- Ser√° preenchido dinamicamente -->
              </div>
            </div>
          </div>

          <!-- Hist√≥rico Detalhado -->
          <div>
            <h3 class="font-semibold mb-4">Hist√≥rico Detalhado</h3>
            <div class="overflow-x-auto">
              <table class="w-full border border-slate-200 rounded-xl overflow-hidden">
                <thead class="bg-slate-50">
                  <tr class="text-left text-sm">
                    <th class="p-3">Data</th>
                    <th class="p-3">Dia da Semana</th>
                    <th class="p-3">Status</th>
                    <th class="p-3">Observa√ß√µes</th>
                  </tr>
                </thead>
                <tbody id="historicoDetalhadoUser" class="text-sm">
                  <!-- Ser√° preenchido dinamicamente -->
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- Modal de Confirma√ß√£o -->
  <div id="modalConfirmacao" class="fixed inset-0 z-50 hidden modal-overlay">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-2xl p-6 w-full max-w-md soft-shadow">
        <h3 class="text-lg font-semibold mb-4" id="tituloModal">Confirmar a√ß√£o</h3>
        <p class="text-slate-600 mb-6" id="mensagemModal">Tem certeza que deseja realizar esta a√ß√£o?</p>
        <div class="flex justify-end gap-2">
          <button id="btnCancelar" class="px-4 py-2 rounded-lg bg-slate-300 hover:bg-slate-400 text-slate-700 transition">Cancelar</button>
          <button id="btnConfirmar" class="px-4 py-2 rounded-lg bg-[#E11D48] hover:bg-[#BE123C] text-white transition">Confirmar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- √Årea para impress√£o -->
  <div id="print-area" class="p-6">
    <h2 class="text-2xl font-bold mb-4">Relat√≥rio ‚Äî Programa Bombeiro Mirim</h2>
    <div id="print-content"></div>
  </div>

  <script>
    // Utilidades
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => document.querySelectorAll(sel);

    // Estado da aplica√ß√£o
    const state = {
      criancas: [],
      presencas: [],
      mensagens: [],
      avisos: [],
      currentUser: null,
      isLoggedIn: false
    };

    function uid() {
      return 'BM' + Math.random().toString(36).slice(2, 9).toUpperCase();
    }

    // LOGIN
    function setupLogin() {
      $('#loginForm').addEventListener('submit', (e) => {
        e.preventDefault();
        
        const user = $('#loginUser').value.trim();
        const password = $('#loginPassword').value.trim();
        
        // Primeiro carregar os dados
        carregarLS();
        
        if (password === '123456') {
          const responsavel = state.criancas.find(c => 
            c.nomeResp && c.nomeResp.toLowerCase().replace(/\s+/g, '.') === user
          );
          
          if (responsavel) {
            state.isLoggedIn = true;
            state.currentUser = responsavel;
            $('#loginScreen').classList.add('hidden');
            $('#app').classList.remove('hidden');
            
            // Inicializar sistema
            initSystem();
          } else {
            alert('Usu√°rio ou senha incorretos!\n\nVerifique as credenciais dispon√≠veis.');
          }
        } else {
          alert('Usu√°rio ou senha incorretos!\n\nVerifique as credenciais dispon√≠veis.');
        }
      });
      
      $('#btnLogout').addEventListener('click', () => {
        mostrarModal('Confirmar logout', 'Deseja realmente sair do sistema?', () => {
          state.isLoggedIn = false;
          state.currentUser = null;
          $('#app').classList.add('hidden');
          $('#loginScreen').classList.remove('hidden');
          
          // Limpar campos de login
          $('#loginUser').value = 'marcos.pereira';
          $('#loginPassword').value = '123456';
        });
      });
    }

    // Armazenamento local
    function salvarLS() {
      localStorage.setItem('bm_user_criancas', JSON.stringify(state.criancas));
      localStorage.setItem('bm_user_presencas', JSON.stringify(state.presencas));
      localStorage.setItem('bm_user_mensagens', JSON.stringify(state.mensagens));
      localStorage.setItem('bm_user_avisos', JSON.stringify(state.avisos));
    }

    function carregarLS() {
      try {
        state.criancas = JSON.parse(localStorage.getItem('bm_user_criancas') || '[]');
        state.presencas = JSON.parse(localStorage.getItem('bm_user_presencas') || '[]');
        state.mensagens = JSON.parse(localStorage.getItem('bm_user_mensagens') || '[]');
        state.avisos = JSON.parse(localStorage.getItem('bm_user_avisos') || '[]');
      } catch(e) {
        state.criancas = [];
        state.presencas = [];
        state.mensagens = [];
        state.avisos = [];
      }
      
      // Dados de exemplo se vazio
      if (state.criancas.length === 0) {
        initDadosExemplo();
      }
    }

    function initDadosExemplo() {
      state.criancas = [
        {
          id: uid(),
          nome: 'Ana Pereira Silva',
          cpf: '12345678901',
          nascimento: '2013-05-12',
          escola: 'EMEF Vila Rosa',
          turma: 'turma-a',
          nomeResp: 'Marcos Pereira',
          contatoResp: '(11) 99999-1111',
          parentesco: 'Pai',
          condicaoMedica: 'asma',
          alergias: 'poeira, √°caros',
          obsMedicas: 'Evitar atividades f√≠sicas intensas'
        },
        {
          id: uid(),
          nome: 'Bruno Santos Costa',
          cpf: '98765432100',
          nascimento: '2012-11-02',
          escola: 'EMEF Centro',
          turma: 'turma-b',
          nomeResp: 'Paula Santos',
          contatoResp: '(11) 97777-3333',
          parentesco: 'M√£e',
          condicaoMedica: 'normal',
          alergias: '',
          obsMedicas: ''
        }
      ];
      
      // Presen√ßas de exemplo (√∫ltimos 30 dias)
      const hoje = new Date();
      state.presencas = [];
      
      for (let i = 0; i < 30; i++) {
        const data = new Date(hoje);
        data.setDate(data.getDate() - i);
        const dataStr = data.toISOString().slice(0, 10);
        
        // Pular fins de semana
        if (data.getDay() === 0 || data.getDay() === 6) continue;
        
        state.criancas.forEach(crianca => {
          const status = Math.random() > 0.1 ? 'presente' : (Math.random() > 0.5 ? 'atraso' : 'falta');
          state.presencas.push({
            id: uid(),
            childId: crianca.id,
            data: dataStr,
            status,
            observacoes: status === 'atraso' ? 'Chegou alguns minutos atrasado' : ''
          });
        });
      }
      
      // Mensagens de exemplo
      state.mensagens = [
        {
          id: uid(),
          tipo: 'recebida',
          remetente: 'Coordena√ß√£o',
          assunto: 'Reuni√£o de Pais - Pr√≥xima Sexta',
          conteudo: 'Prezado respons√°vel, informamos que haver√° reuni√£o de pais na pr√≥xima sexta-feira √†s 19h no audit√≥rio da escola. Contamos com sua presen√ßa!',
          timestamp: new Date().toISOString(),
          urgente: false
        },
        {
          id: uid(),
          tipo: 'recebida',
          remetente: 'Professor da Turma',
          assunto: 'Atividade Especial - Visita ao Quartel',
          conteudo: 'Ol√°! Na pr√≥xima semana teremos uma visita ao Quartel dos Bombeiros. Por favor, envie uma autoriza√ß√£o assinada at√© quinta-feira.',
          timestamp: new Date(Date.now() - 86400000).toISOString(),
          urgente: true
        }
      ];
      
      // Avisos de exemplo
      state.avisos = [
        {
          id: uid(),
          tipo: 'importante',
          titulo: 'Atividade Especial - Visita ao Quartel',
          conteudo: 'Na pr√≥xima semana teremos uma visita especial ao Quartel Central dos Bombeiros. As crian√ßas conhecer√£o os equipamentos e participar√£o de uma demonstra√ß√£o.',
          timestamp: new Date().toISOString(),
          ativo: true
        },
        {
          id: uid(),
          tipo: 'evento',
          titulo: 'Formatura do Programa Bombeiro Mirim',
          conteudo: 'A cerim√¥nia de formatura ser√° realizada no dia 15 de dezembro, √†s 19h, no audit√≥rio principal. Compare√ßam com traje social.',
          timestamp: new Date(Date.now() - 172800000).toISOString(),
          ativo: true
        }
      ];
      
      salvarLS();
    }

    // Navega√ß√£o
    function setupNav() {
      const sections = ['presencas', 'comunicacao', 'relatorio'];
      
      function show(id) {
        sections.forEach(s => {
          const el = document.getElementById(s);
          if (el) el.classList.toggle('hidden', s !== id);
        });
        
        $$('.nav-btn').forEach(b => {
          b.classList.remove('bg-[#E11D48]', 'text-white');
          b.classList.add('text-slate-700');
        });
        const active = [...$$('.nav-btn')].find(b => b.dataset.section === id);
        if (active) {
          active.classList.add('bg-[#E11D48]', 'text-white');
          active.classList.remove('text-slate-700');
        }
        
        // A√ß√µes ao entrar na se√ß√£o
        switch(id) {
          case 'presencas':
            renderPresencasUser();
            break;
          case 'comunicacao':
            setupComunicacaoUserTabs();
            renderComunicacaoUser();
            break;
          case 'relatorio':
            renderRelatorioUser();
            break;
        }
      }
      
      $$('.nav-btn').forEach(btn => btn.addEventListener('click', () => show(btn.dataset.section)));
      show('presencas'); // Presen√ßas como tela inicial
    }

    // PRESEN√áAS DO USU√ÅRIO
    function setupPresencasUser() {
      $('#periodoUser').addEventListener('change', (e) => {
        $('#periodoCustom').classList.toggle('hidden', e.target.value !== 'custom');
        renderPresencasUser();
      });
      
      $('#dataInicioUser, #dataFimUser').forEach(input => {
        input.addEventListener('change', () => renderPresencasUser());
      });
    }

    function renderPresencasUser() {
      if (!state.currentUser) return;
      
      const filho = state.currentUser;
      $('#infoFilho').textContent = `${filho.nome} - ${getTurmaLabel(filho.turma)}`;
      
      // Calcular per√≠odo
      const periodo = $('#periodoUser').value;
      let dataInicio, dataFim;
      
      if (periodo === 'custom') {
        dataInicio = $('#dataInicioUser').value;
        dataFim = $('#dataFimUser').value;
      } else {
        const hoje = new Date();
        dataFim = hoje.toISOString().slice(0, 10);
        const inicio = new Date(hoje);
        inicio.setDate(inicio.getDate() - parseInt(periodo));
        dataInicio = inicio.toISOString().slice(0, 10);
      }
      
      if (!dataInicio || !dataFim) return;
      
      // Filtrar presen√ßas do filho no per√≠odo
      const presencasFilho = state.presencas.filter(p => 
        p.childId === filho.id && 
        p.data >= dataInicio && 
        p.data <= dataFim
      ).sort((a, b) => b.data.localeCompare(a.data));
      
      // Calcular estat√≠sticas
      const totalDias = presencasFilho.length;
      const presentes = presencasFilho.filter(p => p.status === 'presente').length;
      const atrasos = presencasFilho.filter(p => p.status === 'atraso').length;
      const faltas = presencasFilho.filter(p => p.status === 'falta').length;
      const taxa = totalDias > 0 ? Math.round((presentes / totalDias) * 100) : 0;
      
      // Atualizar cards
      $('#totalDiasFilho').textContent = totalDias;
      $('#presentesFilho').textContent = presentes;
      $('#atrasosFilho').textContent = atrasos;
      $('#faltasFilho').textContent = faltas;
      $('#taxaFrequencia').textContent = `${taxa}%`;
      $('#barraFrequencia').style.width = `${taxa}%`;
      
      // Renderizar tabela
      const tbody = $('#tabelaPresencasUser');
      tbody.innerHTML = '';
      
      if (presencasFilho.length === 0) {
        tbody.innerHTML = '<tr><td colspan="3" class="p-4 text-center text-slate-500">Nenhum registro encontrado no per√≠odo selecionado</td></tr>';
        return;
      }
      
      presencasFilho.forEach(p => {
        const data = new Date(p.data);
        const dataFormatada = data.toLocaleDateString('pt-BR');
        
        const statusColors = {
          'presente': 'bg-green-100 text-green-700',
          'atraso': 'bg-yellow-100 text-yellow-700',
          'falta': 'bg-red-100 text-red-700'
        };
        
        const statusIcons = {
          'presente': '‚úÖ',
          'atraso': '‚è∞',
          'falta': '‚ùå'
        };
        
        const tr = document.createElement('tr');
        tr.className = 'border-t';
        tr.innerHTML = `
          <td class="p-4">${dataFormatada}</td>
          <td class="p-4">
            <span class="px-2 py-1 rounded-full text-xs ${statusColors[p.status]}">
              ${statusIcons[p.status]} ${p.status}
            </span>
          </td>
          <td class="p-4">${p.observacoes || '-'}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // COMUNICA√á√ÉO DO USU√ÅRIO
    function setupComunicacaoUser() {
      $('#formMensagemUser').addEventListener('submit', (e) => {
        e.preventDefault();
        enviarMensagemUser();
      });
      
      $('#btnEnviarMsgUser').addEventListener('click', () => {
        // Ir para aba de enviar mensagem
        $$('.tab-btn-user').forEach(t => {
          t.classList.remove('border-[#E11D48]', 'text-[#E11D48]');
          t.classList.add('border-transparent', 'text-slate-500');
        });
        
        $('#tabEnviarUser').classList.remove('border-transparent', 'text-slate-500');
        $('#tabEnviarUser').classList.add('border-[#E11D48]', 'text-[#E11D48]');
        
        $$('.tab-content-user').forEach(c => c.classList.add('hidden'));
        $('#enviarMensagemUser').classList.remove('hidden');
      });
    }

    function setupComunicacaoUserTabs() {
      const tabs = ['tabMensagensUser', 'tabAvisosUser', 'tabEnviarUser'];
      const contents = ['mensagensRecebidas', 'avisosGeraisUser', 'enviarMensagemUser'];
      
      tabs.forEach((tabId, index) => {
        $(`#${tabId}`).addEventListener('click', () => {
          // Atualizar abas
          tabs.forEach(t => {
            const tab = $(`#${t}`);
            tab.classList.remove('border-[#E11D48]', 'text-[#E11D48]');
            tab.classList.add('border-transparent', 'text-slate-500');
          });
          
          $(`#${tabId}`).classList.remove('border-transparent', 'text-slate-500');
          $(`#${tabId}`).classList.add('border-[#E11D48]', 'text-[#E11D48]');
          
          // Mostrar conte√∫do
          contents.forEach((contentId, i) => {
            $(`#${contentId}`).classList.toggle('hidden', i !== index);
          });
        });
      });
    }

    function renderComunicacaoUser() {
      renderMensagensUser();
      renderAvisosUser();
    }

    function renderMensagensUser() {
      const container = $('#listaMensagensUser');
      
      // Filtrar mensagens para este respons√°vel
      const mensagensParaUser = state.mensagens.filter(m => m.tipo === 'recebida');
      
      container.innerHTML = '';
      
      if (mensagensParaUser.length === 0) {
        container.innerHTML = '<div class="text-center text-slate-500 py-8">Nenhuma mensagem recebida</div>';
        return;
      }
      
      mensagensParaUser.reverse().forEach(msg => {
        const div = document.createElement('div');
        div.className = 'p-4 border border-slate-200 rounded-lg';
        
        const data = new Date(msg.timestamp).toLocaleDateString('pt-BR');
        const hora = new Date(msg.timestamp).toLocaleTimeString('pt-BR', { 
          hour: '2-digit', 
          minute: '2-digit' 
        });
        
        div.innerHTML = `
          <div class="flex items-center justify-between mb-2">
            <div class="font-medium">${msg.assunto}</div>
            <div class="flex gap-2">
              ${msg.urgente ? '<span class="px-2 py-1 rounded-full bg-red-100 text-red-700 text-xs">Urgente</span>' : ''}
              <span class="px-2 py-1 rounded-full bg-blue-100 text-blue-700 text-xs">${msg.remetente}</span>
            </div>
          </div>
          <div class="text-sm text-slate-600 mb-3">${msg.conteudo}</div>
          <div class="text-xs text-slate-500">
            Recebido em ${data} √†s ${hora}
          </div>
        `;
        
        container.appendChild(div);
      });
    }

    function renderAvisosUser() {
      const container = $('#listaAvisosUser');
      
      const avisosAtivos = state.avisos.filter(a => a.ativo);
      
      container.innerHTML = '';
      
      if (avisosAtivos.length === 0) {
        container.innerHTML = '<div class="text-center text-slate-500 py-8">Nenhum aviso dispon√≠vel</div>';
        return;
      }
      
      avisosAtivos.reverse().forEach(aviso => {
        const div = document.createElement('div');
        div.className = 'p-4 border border-slate-200 rounded-lg';
        
        const tipoColors = {
          'informativo': 'bg-blue-100 text-blue-700',
          'importante': 'bg-yellow-100 text-yellow-700',
          'urgente': 'bg-red-100 text-red-700',
          'evento': 'bg-green-100 text-green-700'
        };
        
        const data = new Date(aviso.timestamp).toLocaleDateString('pt-BR');
        
        div.innerHTML = `
          <div class="flex items-center justify-between mb-2">
            <div class="font-medium">${aviso.titulo}</div>
            <span class="px-2 py-1 rounded-full text-xs ${tipoColors[aviso.tipo]}">${aviso.tipo}</span>
          </div>
          <div class="text-sm text-slate-600 mb-2">${aviso.conteudo}</div>
          <div class="text-xs text-slate-500">
            Publicado em ${data}
          </div>
        `;
        
        container.appendChild(div);
      });
    }

    function enviarMensagemUser() {
      const destinatario = $('#destinatarioUser').value;
      const assunto = $('#assuntoUser').value.trim();
      const conteudo = $('#conteudoUser').value.trim();
      
      if (!assunto || !conteudo) {
        alert('Preencha o assunto e a mensagem');
        return;
      }
      
      // Simular envio (na pr√°tica seria enviado para o sistema admin)
      const mensagem = {
        id: uid(),
        tipo: 'enviada',
        remetente: state.currentUser.nomeResp,
        crianca: state.currentUser.nome,
        destinatario,
        assunto,
        conteudo,
        timestamp: new Date().toISOString()
      };
      
      state.mensagens.push(mensagem);
      
      // Limpar formul√°rio
      $('#assuntoUser').value = '';
      $('#conteudoUser').value = '';
      $('#destinatarioUser').value = 'coordenacao';
      
      salvarLS();
      alert('Mensagem enviada com sucesso!');
      
      // Voltar para aba de mensagens
      $$('.tab-btn-user').forEach(t => {
        t.classList.remove('border-[#E11D48]', 'text-[#E11D48]');
        t.classList.add('border-transparent', 'text-slate-500');
      });
      
      $('#tabMensagensUser').classList.remove('border-transparent', 'text-slate-500');
      $('#tabMensagensUser').classList.add('border-[#E11D48]', 'text-[#E11D48]');
      
      $$('.tab-content-user').forEach(c => c.classList.add('hidden'));
      $('#mensagensRecebidas').classList.remove('hidden');
    }

    // RELAT√ìRIO DO USU√ÅRIO
    function setupRelatorioUser() {
      $('#periodoRelatorio').addEventListener('change', (e) => {
        const isCustom = e.target.value === 'custom';
        $('#periodoCustomRelatorio').classList.toggle('hidden', !isCustom);
        $('#periodoCustomRelatorio2').classList.toggle('hidden', !isCustom);
        renderRelatorioUser();
      });
      
      $('#dataInicioRelatorio, #dataFimRelatorio').forEach(input => {
        input.addEventListener('change', () => renderRelatorioUser());
      });
      
      $('#btnExportarUser').addEventListener('click', exportarRelatorioUser);
    }

    function renderRelatorioUser() {
      if (!state.currentUser) return;
      
      const filho = state.currentUser;
      $('#infoRelatorioFilho').textContent = `Relat√≥rio de ${filho.nome}`;
      
      // Calcular per√≠odo
      const periodo = $('#periodoRelatorio').value;
      let dataInicio, dataFim;
      
      if (periodo === 'custom') {
        dataInicio = $('#dataInicioRelatorio').value;
        dataFim = $('#dataFimRelatorio').value;
      } else {
        const hoje = new Date();
        dataFim = hoje.toISOString().slice(0, 10);
        const inicio = new Date(hoje);
        inicio.setDate(inicio.getDate() - parseInt(periodo));
        dataInicio = inicio.toISOString().slice(0, 10);
      }
      
      if (!dataInicio || !dataFim) return;
      
      // Filtrar presen√ßas do filho no per√≠odo
      const presencasFilho = state.presencas.filter(p => 
        p.childId === filho.id && 
        p.data >= dataInicio && 
        p.data <= dataFim
      ).sort((a, b) => b.data.localeCompare(a.data));
      
      // Calcular estat√≠sticas
      const totalDias = presencasFilho.length;
      const presentes = presencasFilho.filter(p => p.status === 'presente').length;
      const atrasos = presencasFilho.filter(p => p.status === 'atraso').length;
      const faltas = presencasFilho.filter(p => p.status === 'falta').length;
      const taxa = totalDias > 0 ? Math.round((presentes / totalDias) * 100) : 0;
      
      // Atualizar estat√≠sticas
      $('#totalDiasRel').textContent = totalDias;
      $('#presentesRel').textContent = presentes;
      $('#atrasosRel').textContent = atrasos;
      $('#faltasRel').textContent = faltas;
      $('#taxaRel').textContent = `${taxa}%`;
      
      // Informa√ß√µes da crian√ßa
      const turmaLabel = getTurmaLabel(filho.turma);
      const idade = calcularIdade(filho.nascimento);
      
      $('#infoFilhoRel').innerHTML = `
        <div class="flex justify-between">
          <span>Nome:</span>
          <span class="font-medium">${filho.nome}</span>
        </div>
        <div class="flex justify-between">
          <span>Idade:</span>
          <span class="font-medium">${idade} anos</span>
        </div>
        <div class="flex justify-between">
          <span>Turma:</span>
          <span class="font-medium">${turmaLabel}</span>
        </div>
        <div class="flex justify-between">
          <span>Escola:</span>
          <span class="font-medium">${filho.escola || 'N√£o informado'}</span>
        </div>
        ${filho.condicaoMedica !== 'normal' ? `
        <div class="flex justify-between">
          <span>Condi√ß√£o m√©dica:</span>
          <span class="font-medium text-red-600">${filho.condicaoMedica}</span>
        </div>
        ` : ''}
      `;
      
      // Hist√≥rico detalhado
      const tbody = $('#historicoDetalhadoUser');
      tbody.innerHTML = '';
      
      if (presencasFilho.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="p-3 text-center text-slate-500">Nenhum registro encontrado no per√≠odo</td></tr>';
        return;
      }
      
      presencasFilho.forEach(p => {
        const data = new Date(p.data);
        const dataFormatada = data.toLocaleDateString('pt-BR');
        const diaSemana = data.toLocaleDateString('pt-BR', { weekday: 'long' });
        
        const statusColors = {
          'presente': 'bg-green-100 text-green-700',
          'atraso': 'bg-yellow-100 text-yellow-700',
          'falta': 'bg-red-100 text-red-700'
        };
        
        const tr = document.createElement('tr');
        tr.className = 'border-t';
        tr.innerHTML = `
          <td class="p-3">${dataFormatada}</td>
          <td class="p-3 capitalize">${diaSemana}</td>
          <td class="p-3">
            <span class="px-2 py-1 rounded-full text-xs ${statusColors[p.status]}">
              ${p.status}
            </span>
          </td>
          <td class="p-3">${p.observacoes || '-'}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function exportarRelatorioUser() {
      alert('Funcionalidade de exporta√ß√£o em desenvolvimento.\n\nEm breve voc√™ poder√° baixar o relat√≥rio em PDF.');
    }

    // MODAL
    function setupModal() {
      $('#btnCancelar').addEventListener('click', () => {
        $('#modalConfirmacao').classList.add('hidden');
        state.currentAction = null;
      });
      
      $('#btnConfirmar').addEventListener('click', () => {
        if (state.currentAction) {
          state.currentAction();
        }
        $('#modalConfirmacao').classList.add('hidden');
        state.currentAction = null;
      });
    }

    function mostrarModal(titulo, mensagem, acao) {
      $('#tituloModal').textContent = titulo;
      $('#mensagemModal').textContent = mensagem;
      state.currentAction = acao;
      $('#modalConfirmacao').classList.remove('hidden');
    }

    // FUN√á√ïES AUXILIARES
    function getTurmaLabel(turma) {
      const labels = {
        'turma-a': 'Turma A - Manh√£',
        'turma-b': 'Turma B - Tarde',
        'turma-c': 'Turma C - Integral'
      };
      return labels[turma] || 'Sem turma';
    }

    function calcularIdade(nascimento) {
      const hoje = new Date();
      const nasc = new Date(nascimento);
      let idade = hoje.getFullYear() - nasc.getFullYear();
      const mes = hoje.getMonth() - nasc.getMonth();
      
      if (mes < 0 || (mes === 0 && hoje.getDate() < nasc.getDate())) {
        idade--;
      }
      
      return idade;
    }

    // INICIALIZA√á√ÉO DO SISTEMA
    function initSystem() {
      setupNav();
      setupPresencasUser();
      setupComunicacaoUser();
      setupRelatorioUser();
      setupModal();
      
      // Atualizar header com info do usu√°rio
      updateHeaderUser();
    }

    function updateHeaderUser() {
      if (state.currentUser) {
        const headerSubtitle = $('#headerSubtitle');
        headerSubtitle.textContent = `Bem-vindo(a), ${state.currentUser.nomeResp}`;
        
        // Atualizar bot√£o de usu√°rio
        const userInfo = $('#userInfo');
        if (userInfo) {
          userInfo.textContent = `${state.currentUser.nomeResp.split(' ')[0]}`;
        }
      }
    }

    // Iniciar aplica√ß√£o
    document.addEventListener('DOMContentLoaded', () => {
      // Carregar dados primeiro
      carregarLS();
      setupLogin();
    });
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98dac73351d12ebe',t:'MTc2MDMxNTk0OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
