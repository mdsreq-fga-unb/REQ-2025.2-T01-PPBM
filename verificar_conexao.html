<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifica√ß√£o de Conex√£o Backend-Frontend</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }
        .status-box {
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status-box.success {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }
        .status-box.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }
        .status-box.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 2px solid #17a2b8;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin: 10px 0;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        pre {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
            margin-top: 20px;
        }
        .icon {
            font-size: 24px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Verifica√ß√£o de Conex√£o</h1>
        
        <div id="status-area"></div>
        
        <button onclick="verificarBackend()">Verificar Backend</button>
        <button onclick="testarCadastro()">Testar Cadastro de Aluno</button>
        <button onclick="verificarFrontend()">Verificar Frontend</button>
        
        <pre id="logs">Aguardando verifica√ß√£o...</pre>
    </div>

    <script>
        const backendUrl = 'http://localhost:3000';
        const frontendUrl = 'http://localhost:4321';
        
        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74b9ff';
            logs.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            logs.scrollTop = logs.scrollHeight;
        }

        function showStatus(message, type) {
            const area = document.getElementById('status-area');
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            area.innerHTML = `<div class="status-box ${type}"><span class="icon">${icon}</span>${message}</div>`;
        }

        async function verificarBackend() {
            log('üîç Verificando conex√£o com o backend...', 'info');
            showStatus('Verificando backend...', 'info');
            
            try {
                const response = await fetch(`${backendUrl}/health`);
                const data = await response.json();
                
                if (response.ok) {
                    log(`‚úÖ Backend est√° rodando!`, 'success');
                    log(`   Status: ${data.status}`, 'success');
                    log(`   Ambiente: ${data.environment}`, 'success');
                    log(`   Uptime: ${Math.floor(data.uptime)}s`, 'success');
                    showStatus('Backend est√° rodando corretamente!', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log(`‚ùå Erro ao conectar com o backend: ${error.message}`, 'error');
                log(`   Verifique se o backend est√° rodando em ${backendUrl}`, 'error');
                showStatus(`Erro: ${error.message}. Backend n√£o est√° acess√≠vel.`, 'error');
            }
        }

        async function verificarFrontend() {
            log('üîç Verificando frontend...', 'info');
            showStatus('Verificando frontend...', 'info');
            
            try {
                const response = await fetch(`${frontendUrl}/alunos/cadastrar`);
                
                if (response.ok) {
                    log(`‚úÖ Frontend est√° rodando!`, 'success');
                    log(`   P√°gina de cadastro acess√≠vel`, 'success');
                    showStatus('Frontend est√° rodando corretamente!', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log(`‚ùå Erro ao conectar com o frontend: ${error.message}`, 'error');
                log(`   Verifique se o frontend est√° rodando em ${frontendUrl}`, 'error');
                showStatus(`Erro: ${error.message}. Frontend n√£o est√° acess√≠vel.`, 'error');
            }
        }

        async function testarCadastro() {
            log('üìù Testando cadastro de aluno...', 'info');
            showStatus('Testando cadastro...', 'info');
            
            const testData = {
                aluno: {
                    nome_aluno: 'Jo√£o Silva Teste',
                    data_nascimento_aluno: '2010-05-15',
                    cpf_aluno: '11144477735',
                    escola_unidade: 'Escola Municipal de Teste',
                    tipo_sanguineo: 'O+',
                    nome_guerra: 'Jo√£ozinho',
                    graduacao: 'Soldado',
                    cidade: 'Bras√≠lia',
                    neurodivergente: false
                },
                responsavel: {
                    nome_responsavel: 'Maria Silva Teste',
                    telefone_responsavel: '61987654321',
                    email_responsavel: 'maria.teste@email.com',
                    cpf_responsavel: '52998224725'
                }
            };

            try {
                const response = await fetch(`${backendUrl}/alunos`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    log('‚úÖ Cadastro realizado com sucesso!', 'success');
                    log(`   ID do Aluno: ${result.data?.aluno?.id_aluno}`, 'success');
                    log(`   ID do Respons√°vel: ${result.data?.responsavel?.id_responsavel}`, 'success');
                    showStatus('Cadastro funcionando perfeitamente!', 'success');
                } else {
                    log(`‚ö†Ô∏è Erro no cadastro: ${result.error || result.message}`, 'error');
                    showStatus(`Erro: ${result.error || result.message}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Erro ao testar cadastro: ${error.message}`, 'error');
                showStatus(`Erro: ${error.message}`, 'error');
            }
        }

        window.addEventListener('load', () => {
            log('üöÄ P√°gina de verifica√ß√£o carregada', 'info');
            log('üìå Clique nos bot√µes acima para verificar a conex√£o', 'info');
        });
    </script>
</body>
</html>

